import{_ as a}from"./index-C-jnPPYH.js";import{$ as t,d as e,A as s,r as l,D as o,c as n,w as i,f as r,J as c,a as d,g as u,b as v,i as p,v as f,t as b,h as m,C as I,F as g,ar as _,o as y,x as j}from"./index-BAyZi_co.js";import{b as $}from"./index-FaVgdj3V.js";const h="/schedule/log";function w(a){return t.get(`${h}`,a)}function k(a){return t.post(`${h}/stop/${a}`)}function x(a){return t.post(`${h}/retry/${a}`)}const R={style:{display:"flex"}},D={style:{padding:"10px 10px"}},S={class:"job_list"},C=["onClick"],Y={class:"content"},B={class:"title"},M={class:"status"},O={class:"code_view"},z=j(e({__name:"LogDetailDrawer",setup(e,{expose:j}){const{width:w}=$(),k=s({}),x=l([]),z=l(!1),H=l(!1),L=l(""),A={1:{title:"待处理",color:"gray",isRun:!1},2:{title:"运行中",color:"cyan",isRun:!0},3:{title:"成功",color:"green",isRun:!1},4:{title:"已失败",color:"red",isRun:!1},5:{title:"已停止",color:"purple",isRun:!1},6:{title:"已取消",color:"orange",isRun:!1}},F=a=>{const t=new Date(Number.parseInt(a.time_stamp));let e=`${_(t).format("YYYY-MM-DD HH:mm:ss")} ${a.level} [${a.thread}] ${a.location} - ${a.message}`;return a.throwable&&(e+=`\n ${a.throwable}`),e},J=l(""),N=l(),P=async a=>{var e,s;L.value=null==a?void 0:a.id;try{const l=await(s={taskBatchId:a.taskBatchId,jobId:a.jobId,taskId:a.id,startId:0,fromIndex:0,size:50},t.get(`${h}/instance/log`,s));(null==(e=l.data)?void 0:e.finished)&&clearInterval(N.value),J.value=l.data.message.map(F).join("\n")}catch(l){J.value=""}},T=a=>{J.value="",clearInterval(N.value);A[a.taskStatus].isRun?N.value=setInterval((()=>{P(a)}),1e3):P(a)},U=async(a={...k})=>{try{H.value=!0;const e=await function(a){return t.get(`${h}/instance`,a)}(a);x.value=e.data,T(x.value[0])}finally{H.value=!1}},q=()=>{clearInterval(N.value)};o((()=>{clearInterval(N.value)}));return j({onOpen:async a=>{k.jobId=a.jobId,k.taskBatchId=a.id,z.value=!0,await U()}}),(t,e)=>{const s=d("a-tag"),l=a,o=d("a-drawer");return y(),n(o,{visible:r(z),"onUpdate:visible":e[0]||(e[0]=a=>c(z)?z.value=a:null),title:"任务日志详情",width:r(w)>=1300?1300:"100%",footer:!1,onClose:q},{default:i((()=>[u("div",R,[u("div",D,[u("div",S,[(y(!0),v(g,null,p(r(x),(a=>(y(),v("div",{key:a.id,class:f("job_list_item "+(a.id===r(L)?"active":"")),onClick:t=>T(a)},[u("div",Y,[u("span",B,b(a.clientInfo.split("@")[1]),1),u("span",M,[m(s,{bordered:"",color:A[a.taskStatus].color},{default:i((()=>[I(b(A[a.taskStatus].title),1)])),_:2},1032,["color"])])])],10,C)))),128))])]),u("div",O,[m(l,{"code-json":r(J)},null,8,["code-json"])])])])),_:1},8,["visible","width"])}}}),[["__scopeId","data-v-11da54eb"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{z as L,H as a,w as l,x as r,k as s};
