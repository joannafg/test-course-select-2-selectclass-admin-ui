import{b as e}from"./index-FaVgdj3V.js";import{$ as t,d as a,r as s,p as l,z as r,A as n,c as o,w as d,f as i,J as u,a as p,h as c,o as m,M as f}from"./index-BAyZi_co.js";import{_ as v}from"./GiForm-BWZRNfN-.js";import{u as h}from"./useResetReactive-NMdkdCz2.js";const b="/system/dept";function y(e){return t.get(`${b}/tree`,e)}function w(e){return t.del(`${b}/${e}`)}function g(e){return t.download(`${b}/export`,e)}const x=a({__name:"DeptAddModal",props:{depts:{default:()=>[]}},emits:["save-success"],setup(a,{expose:y,emit:w}){const g=a,x=w,{width:$}=e(),k=s(""),R=s(!1),_=l((()=>!!k.value)),j=l((()=>_.value?"modify department":"add department")),O=s(),V=l((()=>{const e=JSON.parse(JSON.stringify(g.depts));return r.mapTree(e,(e=>({key:e.id,title:e.name,children:e.children})))})),C={form:{size:"large"},btns:{hide:!0}},[L,S]=h({sort:999,status:1}),T=n([{label:"parent department",field:"parentId",type:"tree-select",data:V,hide:e=>0===e.parentId,props:{allowClear:!0,allowSearch:!0,fallbackOption:!1,filterTreeNode:(e,t)=>!!t.title&&t.title.toLowerCase().includes(e.toLowerCase())},rules:[{required:!0,message:"please select the parent department"}]},{label:"name",field:"name",type:"input",rules:[{required:!0,message:"please enter the name"}],props:{maxLength:30}},{label:"sort",field:"sort",type:"input-number",props:{min:1,mode:"button"}},{label:"description",field:"description",type:"textarea",props:{maxLength:200,autoSize:{minRows:3,maxRows:5}}},{label:"status",field:"status",type:"switch",props:{type:"round",checkedValue:1,uncheckedValue:2,checkedText:"enable",uncheckedText:"disable"}}]),z=()=>{var e,t;null==(t=null==(e=O.value)?void 0:e.formRef)||t.resetFields(),S()},A=async()=>{var e,a,s,l;try{return!(await(null==(a=null==(e=O.value)?void 0:e.formRef)?void 0:a.validate()))&&(_.value?(await(s=L,l=k.value,t.put(`${b}/${l}`,s)),f.success("modify successfully")):(await function(e){return t.post(`${b}`,e)}(L),f.success("add successfully")),x("save-success"),!0)}catch(r){return!1}};return y({onAdd:e=>{z(),L.parentId=e,k.value="",R.value=!0},onUpdate:async e=>{z(),k.value=e;const{data:a}=await function(e){return t.get(`${b}/${e}`)}(e);Object.assign(L,a),R.value=!0}}),(e,t)=>{const a=p("a-modal");return m(),o(a,{visible:i(R),"onUpdate:visible":t[1]||(t[1]=e=>u(R)?R.value=e:null),title:i(j),"mask-closable":!1,"esc-to-close":!1,width:i($)>=500?500:"100%",draggable:"",onBeforeOk:A,onClose:z},{default:d((()=>[c(i(v),{ref_key:"formRef",ref:O,modelValue:i(L),"onUpdate:modelValue":t[0]||(t[0]=e=>u(L)?L.value=e:null),options:C,columns:i(T)},null,8,["modelValue","columns"])])),_:1},8,["visible","title","width"])}}});export{x as _,w as d,g as e,y as l};
