import{x as e,a6 as t,aa as i,r as a,A as s,p as r,S as o,B as l,b as n,o as c,e as u,g as h,q as p,G as d,h as v,ah as g,w as f,v as m,t as y,P as b,W as S,F as x,i as w,C as k,c as z,R as $,y as B}from"./index-BAyZi_co.js";import{c as W,a as T}from"./captcha-noq_IUbv.js";import{a as C}from"./encrypt-fe7GwHAY.js";function N(e){let t,i,a,s;const r=e.$el.parentNode.offsetWidth||window.innerWidth,o=e.$el.parentNode.offsetHeight||window.innerHeight;return t=e.imgSize.width.includes("%")?Number.parseInt(e.imgSize.width,10)/100*r+"px":e.imgSize.width,i=e.imgSize.height.includes("%")?Number.parseInt(e.imgSize.height,10)/100*o+"px":e.imgSize.height,a=e.barSize.width.includes("%")?Number.parseInt(e.barSize.width,10)/100*r+"px":e.barSize.width,s=e.barSize.height.includes("%")?Number.parseInt(e.barSize.height,10)/100*o+"px":e.barSize.height,{imgWidth:t,imgHeight:i,barWidth:a,barHeight:s}}const I={style:{position:"relative"}},H=["src"],O=["textContent"],L=["textContent"],j=["src"];const P={style:{position:"relative"}},J={class:"verify-img-out"},M=["src"],V={class:"verify-msg"};const E={key:0,class:"verifybox-top"};const A=e({name:"Vue2Verify",components:{VerifySlide:e({name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右滑动完成验证"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(e){const{mode:n,captchaType:c,type:u,blockSize:h,explain:p}=t(e),{proxy:d}=i(),v=a(),g=a(),f=a(),m=a(),y=a(),b=a(),x=a(),w=a(),k=a(),z=a(),$=a(),B=s({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),I=a(0),H=a(0),O=a(),L=a(),j=a(),P=a("#ddd"),J=a(),M=a("icon-right"),V=a(!1),E=a(!1),A=a(!0),R=a(""),X=a(""),F=a(0);const K=r((()=>d.$el.querySelector(".verify-bar-area")));function q(e){if(e=e||window.event,V.value&&!1===E.value){let t;t=e.touches?e.touches[0].pageX:e.clientX;let i=t-K.value.getBoundingClientRect().left;i>=K.value.offsetWidth-Number.parseInt(h.value.width,10)/2-2&&(i=K.value.offsetWidth-Number.parseInt(h.value.width,10)/2-2),i<=0&&(i=Number.parseInt(h.value.width,10)/2),O.value=i-F.value+"px",L.value=i-F.value+"px"}}const D=()=>{A.value=!0,$.value="",R.value="left .3s",O.value=0,L.value=void 0,X.value="width .3s",P.value="#ddd",j.value="#fff",J.value="#000",M.value="icon-right",E.value=!1,function(){const e={captchaType:c.value};T(e).then((e=>{f.value=e.data.originalImageBase64,m.value=e.data.jigsawImageBase64,y.value=e.data.token,v.value=e.data.secretKey}))}(),setTimeout((()=>{X.value="",R.value="",z.value=p.value}),300)};function _(){if(x.value=+new Date,V.value&&!1===E.value){let e=Number.parseInt((O.value||"").replace("px",""),10);e=310*e/Number.parseInt(`${B.imgWidth}`,10);const t={captchaType:c.value,pointJson:v.value?C(JSON.stringify({x:e,y:5}),v.value):JSON.stringify({x:e,y:5}),token:y.value};W(t).then((t=>{if(t.success&&"0000"===t.data.repCode){j.value="#5cb85c",P.value="#5cb85c",J.value="#fff",M.value="icon-check",A.value=!1,E.value=!0,"pop"===n.value&&setTimeout((()=>{d.$parent.clickShow=!1,D()}),1500),g.value=!0,k.value=`${((x.value-b.value)/1e3).toFixed(2)}s验证成功`;const t=v.value?C(`${y.value}---${JSON.stringify({x:e,y:5})}`,v.value):`${y.value}---${JSON.stringify({x:e,y:5})}`;setTimeout((()=>{k.value="",d.$parent.closeBox(),d.$parent.$emit("success",{captchaVerification:t})}),1e3)}else j.value="#d9534f",P.value="#d9534f",J.value="#fff",M.value="icon-close",g.value=!1,setTimeout((()=>{D()}),1e3),d.$parent.$emit("error",d),k.value=t.data.repMsg,setTimeout((()=>{k.value=""}),1e3)})),V.value=!1}}function G(){z.value=p.value,S((()=>{const{imgHeight:e,imgWidth:t,barHeight:i,barWidth:a}=N(d);B.imgHeight=e,B.imgWidth=t,B.barHeight=i,B.barWidth=a,d.$parent.$emit("ready",d)})),window.removeEventListener("touchmove",(e=>{q(e)})),window.removeEventListener("mousemove",(e=>{q(e)})),window.removeEventListener("touchend",(()=>{_()})),window.removeEventListener("mouseup",(()=>{_()})),window.addEventListener("touchmove",(e=>{q(e)})),window.addEventListener("mousemove",(e=>{q(e)})),window.addEventListener("touchend",(()=>{_()})),window.addEventListener("mouseup",(()=>{_()}))}return o(u,(()=>{G()})),l((()=>{G(),d.$el.onselectstart=function(){return!1}})),{secretKey:v,passFlag:g,backImgBase:f,blockBackImgBase:m,backToken:y,startMoveTime:b,endMovetime:x,tipsBackColor:w,tipWords:k,text:z,finishText:$,setSize:B,top:I,left:H,moveBlockLeft:O,leftBarWidth:L,moveBlockBackgroundColor:j,leftBarBorderColor:P,iconColor:J,iconClass:M,status:V,isEnd:E,showRefresh:A,transitionLeft:R,transitionWidth:X,barArea:K,refresh:D,start:function(e){let t;t=(e=e||window.event).touches?e.touches[0].pageX:e.clientX,F.value=Math.floor(t-K.value.getBoundingClientRect().left),b.value=+new Date,!1===E.value&&(z.value="",j.value="#337ab7",P.value="#337AB7",J.value="#fff",e.stopPropagation(),V.value=!0)}}}},[["render",function(e,t,i,a,s,r){return c(),n("div",I,["2"===i.type?(c(),n("div",{key:0,class:"verify-img-out",style:p({height:`${parseInt(a.setSize.imgHeight)+i.vSpace}px`})},[h("div",{class:"verify-img-panel",style:p({width:a.setSize.imgWidth,height:a.setSize.imgHeight})},[h("img",{src:`data:image/png;base64,${a.backImgBase}`,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,H),d(h("div",{class:"verify-refresh",onClick:t[0]||(t[0]=(...e)=>a.refresh&&a.refresh(...e))},t[3]||(t[3]=[h("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[g,a.showRefresh]]),v(b,{name:"tips"},{default:f((()=>[a.tipWords?(c(),n("span",{key:0,class:m(["verify-tips",a.passFlag?"suc-bg":"err-bg"])},y(a.tipWords),3)):u("",!0)])),_:1})],4)],4)):u("",!0),h("div",{class:"verify-bar-area",style:p({width:a.setSize.imgWidth,height:i.barSize.height,"line-height":i.barSize.height})},[h("span",{class:"verify-msg",textContent:y(a.text)},null,8,O),h("div",{class:"verify-left-bar",style:p({width:void 0!==a.leftBarWidth?a.leftBarWidth:i.barSize.height,height:i.barSize.height,"border-color":a.leftBarBorderColor,transaction:a.transitionWidth})},[h("span",{class:"verify-msg",textContent:y(a.finishText)},null,8,L),h("div",{class:"verify-move-block",style:p({width:i.barSize.height,height:i.barSize.height,"background-color":a.moveBlockBackgroundColor,left:a.moveBlockLeft,transition:a.transitionLeft}),onTouchstart:t[1]||(t[1]=(...e)=>a.start&&a.start(...e)),onMousedown:t[2]||(t[2]=(...e)=>a.start&&a.start(...e))},[h("i",{class:m(["verify-icon iconfont",[a.iconClass]]),style:p({color:a.iconColor})},null,6),"2"===i.type?(c(),n("div",{key:0,class:"verify-sub-block",style:p({width:`${Math.floor(47*parseInt(a.setSize.imgWidth)/310)}px`,height:a.setSize.imgHeight,top:`-${parseInt(a.setSize.imgHeight)+i.vSpace}px`,"background-size":`${a.setSize.imgWidth} ${a.setSize.imgHeight}`})},[h("img",{src:`data:image/png;base64,${a.blockBackImgBase}`,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,j)],4)):u("",!0)],36)],4)],4)])}]]),VerifyPoints:e({name:"VerifyPoints",props:{mode:{type:String,default:""},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(e){const{mode:r,captchaType:o}=t(e),{proxy:n}=i(),c=a(""),u=a(3),h=s([]),p=s([]),d=a(1),v=a(""),g=s([]),f=a(""),m=s({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),y=s([]),b=a(""),x=a(),w=a(),k=a(!0),z=a(!0);function $(){const e={captchaType:o.value};T(e).then((e=>{v.value=e.data.originalImageBase64,f.value=e.data.token,c.value=e.data.secretKey,g.push(e.data.wordList),b.value=`请依次点击【${g.join(",")}】`,g.length=0}))}const B=function(e){return{x:e.offsetX,y:e.offsetY}},I=function(e){return y.push({...e}),d.value+1},H=function(e,t){return e.map((e=>({x:Math.round(310*e.x/Number.parseInt(t.imgWidth,10)),y:Math.round(155*e.y/Number.parseInt(t.imgHeight,10))})))},O=()=>{h.splice(0,h.length),p.splice(0,p.length),d.value=1,$(),S((()=>{const{imgHeight:e,imgWidth:t,barHeight:i,barWidth:a}=N(n);m.imgHeight=e,m.imgWidth=t,m.barHeight=i,m.barWidth=a,n.$parent.$emit("ready",n)}))};l((()=>{O(),n.$el.onselectstart=function(){return!1}}));const L=function(){y.splice(0,y.length),x.value="#000",w.value="#ddd",z.value=!0,h.splice(0,h.length),p.splice(0,p.length),d.value=1,$(),b.value="验证失败",k.value=!0},j=a(null);return{secretKey:c,checkNum:u,fontPos:h,checkPosArr:p,num:d,pointBackImgBase:v,poinTextList:g,backToken:f,setSize:m,tempPoints:y,text:b,barAreaColor:x,barAreaBorderColor:w,showRefresh:k,bindingClick:z,init:O,canvas:j,canvasClick:e=>{if(p.push(B(e)),d.value===u.value){d.value=I(B(e));const t=H(p,m);p.length=0,p.push(...t),setTimeout((()=>{const e=c.value?C(`${f.value}---${JSON.stringify(p)}`,c.value):`${f.value}---${JSON.stringify(p)}`,t={captchaType:o.value,pointJson:c.value?C(JSON.stringify(p),c.value):JSON.stringify(p),token:f.value};W(t).then((t=>{t.success&&"0000"===t.data.repCode?(x.value="#4cae4c",w.value="#5cb85c",b.value="验证成功",z.value=!1,"pop"===r.value&&setTimeout((()=>{n.$parent.clickShow=!1,L()}),1500),n.$parent.$emit("success",{captchaVerification:e})):(n.$parent.$emit("error",n),x.value="#d9534f",w.value="#d9534f",b.value=t.data.repMsg,setTimeout((()=>{L()}),700))}))}),400)}d.value<u.value&&(d.value=I(B(e)))},getMousePos:B,createPoint:I,refresh:L,getPicture:$,pointTransform:H}}},[["render",function(e,t,i,a,s,r){return c(),n("div",P,[h("div",J,[h("div",{class:"verify-img-panel",style:p({width:a.setSize.imgWidth,height:a.setSize.imgHeight,"background-size":`${a.setSize.imgWidth} ${a.setSize.imgHeight}`,"margin-bottom":`${i.vSpace}px`})},[d(h("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:t[0]||(t[0]=(...e)=>a.refresh&&a.refresh(...e))},t[2]||(t[2]=[h("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[g,a.showRefresh]]),h("img",{ref:"canvas",src:`data:image/png;base64,${a.pointBackImgBase}`,alt:"",style:{width:"100%",height:"100%",display:"block"},onClick:t[1]||(t[1]=e=>a.bindingClick?a.canvasClick(e):void 0)},null,8,M),(c(!0),n(x,null,w(a.tempPoints,((e,t)=>(c(),n("div",{key:t,class:"point-area",style:p({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:`${parseInt(""+(e.y-10))}px`,left:`${parseInt(""+(e.x-10))}px`})},y(t+1),5)))),128))],4)]),h("div",{class:"verify-bar-area",style:p({width:a.setSize.imgWidth,color:a.barAreaColor,"border-color":a.barAreaBorderColor,"line-height":i.barSize.height})},[h("span",V,y(a.text),1)],4)])}]])},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},space:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(e){const{captchaType:i,mode:s}=t(e),o=a(!1),l=a(),n=a(),c=a({}),u=r((()=>"pop"!==s.value||o.value));return B((()=>{switch(i.value){case"blockPuzzle":l.value="2",n.value="VerifySlide";break;case"clickWord":l.value="",n.value="VerifyPoints"}})),{clickShow:o,verifyType:l,componentType:n,instance:c,showBox:u,closeBox:()=>{o.value=!1,c.value={}},show:()=>{"pop"===s.value&&(o.value=!0)}}}},[["render",function(e,t,i,a,s,r){return d((c(),n("div",{class:m("pop"===i.mode?"mask":"")},[h("div",{class:m("pop"===i.mode?"verifybox":""),style:p({"max-width":`${parseInt(i.imgSize.width)+30}px`})},["pop"===i.mode?(c(),n("div",E,[t[2]||(t[2]=k(" 请完成安全验证 ")),h("span",{class:"verifybox-close",onClick:t[0]||(t[0]=(...e)=>a.closeBox&&a.closeBox(...e))},t[1]||(t[1]=[h("i",{class:"iconfont icon-close"},null,-1)]))])):u("",!0),h("div",{class:"verifybox-bottom",style:p({padding:"pop"===i.mode?"15px":"0"})},[a.componentType?(c(),z($(a.componentType),{key:0,ref:"instance",space:i.space,"captcha-type":i.captchaType,type:a.verifyType,figure:i.figure,arith:i.arith,mode:i.mode,explain:i.explain,"img-size":i.imgSize,"block-size":i.blockSize,"bar-size":i.barSize},null,8,["space","captcha-type","type","figure","arith","mode","explain","img-size","block-size","bar-size"])):u("",!0)],4)],6)],2)),[[g,a.showBox]])}]]);export{A as _};
