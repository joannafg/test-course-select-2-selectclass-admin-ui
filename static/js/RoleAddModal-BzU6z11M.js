import{d as e,r as l,c as a,w as t,f as d,J as u,a as s,h as o,C as n,G as i,ah as c,g as r,e as m,M as p,o as f,x as h}from"./index-BAyZi_co.js";import{b as v}from"./index-FaVgdj3V.js";import{a as k}from"./role-C1QTvPIM.js";import{u as y}from"./useResetReactive-NMdkdCz2.js";import{u as _}from"./useMenu-C8VM0Jot.js";import{u as b}from"./useDept-CXLwDhMr.js";import{u as V}from"./useDict-ConFaTXJ.js";const g=h(e({__name:"RoleAddModal",emits:["save-success"],setup(e,{expose:h,emit:g}){const x=g,{width:C}=v(),w=l(""),S=l(!1),U=l(),{data_scope_enum:M}=V("data_scope_enum"),{deptList:I,getDeptList:R}=b(),{menuList:j,getMenuList:A}=_(),L={name:[{required:!0,message:"please enter the name"}],code:[{required:!0,message:"please enter the code"}],dataScope:[{required:!0,message:"please select the data permission"}]},[N,q]=y({menuCheckStrictly:!0,deptCheckStrictly:!0,sort:999,dataScope:4}),z=l(),D=l(),T=l(!1),F=l(!0),H=l(!1),K=l(!1),G=l(1),J=()=>{var e,l,a;T.value=!1,H.value=!1,F.value=!0,K.value=!1,null==(e=z.value)||e.expandAll(T.value),null==(l=D.value)||l.expandAll(F.value),G.value=1,null==(a=U.value)||a.resetFields(),q()},O=()=>{G.value=Math.max(1,G.value-1)},B=async()=>{var e;try{if(1===G.value){if(await(null==(e=U.value)?void 0:e.validateField(["name","code","sort","description"])))return}G.value=Math.min(3,G.value+1)}catch(l){}},E=e=>{G.value=e},P=(e,l)=>{var a,t;const d={menu:z,dept:D}[e];d&&"expand"===l?null==(a=d.value)||a.expandAll("menu"===e?T.value:F.value):d&&"check"===l&&(null==(t=d.value)||t.checkAll("menu"===e?H.value:K.value))},Q=e=>P(e,"expand"),W=e=>P(e,"check"),X=async()=>{var e;try{return!(await(null==(e=U.value)?void 0:e.validate()))&&(N.menuIds=(()=>{var e,l;const a=(null==(e=z.value)?void 0:e.getCheckedNodes()).map((e=>e.key)),t=(null==(l=z.value)?void 0:l.getHalfCheckedNodes()).map((e=>e.key));return a.unshift(...t),a})(),N.deptIds=(()=>{var e,l;if(!D.value)return[];const a=(null==(e=D.value)?void 0:e.getCheckedNodes()).map((e=>e.key)),t=(null==(l=D.value)?void 0:l.getHalfCheckedNodes()).map((e=>e.key));return a.unshift(...t),a})(),await k(N),p.success("add successfully"),x("save-success"),!0)}catch(l){return!1}},Y=()=>{3===d(G)&&(X(),S.value=!1)};return h({onOpen:async()=>{J(),j.value.length||await A(),I.value.length||await R(),w.value="",S.value=!0}}),(e,l)=>{const p=s("a-step"),h=s("a-steps"),v=s("a-input"),k=s("a-form-item"),y=s("a-input-number"),_=s("a-textarea"),b=s("a-checkbox"),V=s("a-space"),g=s("a-tree"),x=s("a-select"),w=s("a-form"),R=s("IconLeft"),A=s("a-button"),q=s("IconRight"),P=s("a-modal");return f(),a(P,{visible:d(S),"onUpdate:visible":l[17]||(l[17]=e=>u(S)?S.value=e:null),title:"add role","mask-closable":!1,"esc-to-close":!0,draggable:"",width:d(C)>=600?600:"100%",onClose:J},{footer:t((()=>[o(V,{size:"large"},{default:t((()=>[o(A,{disabled:1===d(G),type:"secondary",onClick:O},{default:t((()=>[o(R),l[27]||(l[27]=n(" previous step "))])),_:1},8,["disabled"]),3!==d(G)?(f(),a(A,{key:0,disabled:3===d(G),type:"primary",onClick:B},{default:t((()=>[l[28]||(l[28]=n(" next step ")),o(q)])),_:1},8,["disabled"])):m("",!0),3===d(G)?(f(),a(A,{key:1,type:"primary",onClick:Y},{default:t((()=>l[29]||(l[29]=[n("confirm")]))),_:1})):m("",!0)])),_:1})])),default:t((()=>[o(h,{current:d(G),class:"mb-15",onChange:E},{default:t((()=>[o(p,null,{default:t((()=>l[18]||(l[18]=[n("basic information")]))),_:1}),o(p,null,{default:t((()=>l[19]||(l[19]=[n("function permission")]))),_:1}),o(p,null,{default:t((()=>l[20]||(l[20]=[n("data permission")]))),_:1})])),_:1},8,["current"]),o(w,{ref_key:"formRef",ref:U,model:d(N),rules:L,size:"large","auto-label-width":""},{default:t((()=>[i(r("fieldset",null,[o(k,{label:"name",field:"name"},{default:t((()=>[o(v,{modelValue:d(N).name,"onUpdate:modelValue":l[0]||(l[0]=e=>d(N).name=e),modelModifiers:{trim:!0},placeholder:"please enter the name"},null,8,["modelValue"])])),_:1}),o(k,{label:"code",field:"code"},{default:t((()=>[o(v,{modelValue:d(N).code,"onUpdate:modelValue":l[1]||(l[1]=e=>d(N).code=e),modelModifiers:{trim:!0},placeholder:"please enter the code"},null,8,["modelValue"])])),_:1}),o(k,{label:"sort",field:"sort"},{default:t((()=>[o(y,{modelValue:d(N).sort,"onUpdate:modelValue":l[2]||(l[2]=e=>d(N).sort=e),placeholder:"please enter the sort",min:1,mode:"button"},null,8,["modelValue"])])),_:1}),o(k,{label:"description",field:"description"},{default:t((()=>[o(_,{modelValue:d(N).description,"onUpdate:modelValue":l[3]||(l[3]=e=>d(N).description=e),modelModifiers:{trim:!0},placeholder:"please enter the description","show-word-limit":"","max-length":200,"auto-size":{minRows:3,maxRows:5}},null,8,["modelValue"])])),_:1})],512),[[c,1===d(G)]]),i(r("fieldset",null,[o(k,{"hide-label":"",disabled:d(N).isSystem,class:"w-full"},{extra:t((()=>[o(g,{ref_key:"menuTreeRef",ref:z,"checked-keys":d(N).menuIds,"onUpdate:checkedKeys":l[9]||(l[9]=e=>d(N).menuIds=e),class:"w-full menu-tree",data:d(j),"default-expand-all":d(T),"check-strictly":!d(N).menuCheckStrictly,"virtual-list-props":{height:400},checkable:""},null,8,["checked-keys","data","default-expand-all","check-strictly"])])),default:t((()=>[o(V,null,{default:t((()=>[o(b,{modelValue:d(T),"onUpdate:modelValue":l[4]||(l[4]=e=>u(T)?T.value=e:null),onChange:l[5]||(l[5]=e=>Q("menu"))},{default:t((()=>l[21]||(l[21]=[n("expand/collapse")]))),_:1},8,["modelValue"]),o(b,{modelValue:d(H),"onUpdate:modelValue":l[6]||(l[6]=e=>u(H)?H.value=e:null),onChange:l[7]||(l[7]=e=>W("menu"))},{default:t((()=>l[22]||(l[22]=[n("select all/unselect all")]))),_:1},8,["modelValue"]),o(b,{modelValue:d(N).menuCheckStrictly,"onUpdate:modelValue":l[8]||(l[8]=e=>d(N).menuCheckStrictly=e)},{default:t((()=>l[23]||(l[23]=[n("parent-child linkage")]))),_:1},8,["modelValue"])])),_:1})])),_:1},8,["disabled"])],512),[[c,2===d(G)]]),i(r("fieldset",null,[o(k,{"hide-label":"",field:"dataScope"},{default:t((()=>[o(x,{modelValue:d(N).dataScope,"onUpdate:modelValue":l[10]||(l[10]=e=>d(N).dataScope=e),modelModifiers:{trim:!0},options:d(M),placeholder:"please select the data permission",disabled:d(N).isSystem},null,8,["modelValue","options","disabled"])])),_:1}),5===d(N).dataScope?(f(),a(k,{key:0,"hide-label":"",disabled:d(N).isSystem},{extra:t((()=>[o(g,{ref_key:"deptTreeRef",ref:D,"checked-keys":d(N).deptIds,"onUpdate:checkedKeys":l[16]||(l[16]=e=>d(N).deptIds=e),class:"w-full",data:d(I),"default-expand-all":d(F),"check-strictly":!d(N).deptCheckStrictly,"virtual-list-props":{height:350},checkable:""},null,8,["checked-keys","data","default-expand-all","check-strictly"])])),default:t((()=>[o(V,null,{default:t((()=>[o(b,{modelValue:d(F),"onUpdate:modelValue":l[11]||(l[11]=e=>u(F)?F.value=e:null),onChange:l[12]||(l[12]=e=>Q("dept"))},{default:t((()=>l[24]||(l[24]=[n("expand/collapse")]))),_:1},8,["modelValue"]),o(b,{modelValue:d(K),"onUpdate:modelValue":l[13]||(l[13]=e=>u(K)?K.value=e:null),onChange:l[14]||(l[14]=e=>W("dept"))},{default:t((()=>l[25]||(l[25]=[n("select all/unselect all")]))),_:1},8,["modelValue"]),o(b,{modelValue:d(N).deptCheckStrictly,"onUpdate:modelValue":l[15]||(l[15]=e=>d(N).deptCheckStrictly=e)},{default:t((()=>l[26]||(l[26]=[n("parent-child linkage")]))),_:1},8,["modelValue"])])),_:1})])),_:1},8,["disabled"])):m("",!0)],512),[[c,3===d(G)]])])),_:1},8,["model"])])),_:1},8,["visible","width"])}}}),[["__scopeId","data-v-15b948ac"]]);export{g as default};
