import{d as e,r as a,c as l,w as t,f as s,J as o,a as u,h as i,e as d,g as r,C as n,_ as p,b as c,M as m,o as f,x as v}from"./index-BAyZi_co.js";import{b as w}from"./index-FaVgdj3V.js";import{p as h,d as y,i as b}from"./user-D7V0nsbJ.js";import{u as _}from"./useDownload-C-k5xGNE.js";import{u as x}from"./useResetReactive-NMdkdCz2.js";const k={class:"file-box"},R={key:0},g={class:"file-box"},U={class:"file-box"},V=v(e({__name:"UserImportDrawer",emits:["save-success"],setup(e,{expose:v,emit:V}){const P=V,{width:E}=w(),K=a(!1),j=a(),S=a([]),[z,C]=x({errorPolicy:1,duplicateUser:1,duplicateEmail:1,duplicatePhone:1,defaultStatus:1}),I=a({importKey:"",totalRows:0,validRows:0,duplicateUserRows:0,duplicateEmailRows:0,duplicatePhoneRows:0}),D=()=>{var e;null==(e=j.value)||e.resetFields(),I.value.importKey="",S.value=[],C()},q=()=>{_((()=>y()))},F=e=>{const a=new AbortController;return async function(){const{onProgress:a,onError:l,onSuccess:t,fileItem:s,name:o="file"}=e;a(20);const u=new FormData;u.append(o,s.file);try{const e=await h(u);I.value=e.data,m.success("upload and parse successfully"),t(e)}catch(i){l(i)}}(),{abort(){a.abort()}}},O=async()=>{try{if(!I.value.importKey)return m.warning("please upload the file and parse the import data"),!1;z.importKey=I.value.importKey;const e=await b(z);return m.success(`import successfully! add ${e.data.insertRows}, update ${e.data.updateRows}`),P("save-success"),!0}catch(e){return!1}};return v({onOpen:()=>{D(),K.value=!0}}),(e,a)=>{const m=p,v=u("a-link"),w=u("a-alert"),h=u("a-upload"),y=u("a-statistic"),b=u("a-space"),_=u("a-radio"),x=u("a-radio-group"),V=u("a-form-item"),P=u("a-switch"),C=u("a-form"),$=u("a-drawer");return f(),l($,{visible:s(K),"onUpdate:visible":a[4]||(a[4]=e=>o(K)?K.value=e:null),title:"import user","mask-closable":!1,"esc-to-close":!1,width:s(E)>=600?600:"100%","ok-text":"confirm import","cancel-text":"cancel import",onBeforeOk:O,onClose:D},{default:t((()=>[i(C,{ref_key:"formRef",ref:j,model:s(z),size:"large","auto-label-width":""},{default:t((()=>[s(z).disabled?d("",!0):(f(),l(w,{key:0,style:{"margin-bottom":"15px"}},{action:t((()=>[i(v,{onClick:q},{icon:t((()=>[i(m,{name:"file-excel",size:16})])),default:t((()=>a[5]||(a[5]=[n("download template")]))),_:1})])),default:t((()=>[a[6]||(a[6]=n(" please fill in the data according to the template requirements, and then upload and parse the data. "))])),_:1})),r("fieldset",null,[a[7]||(a[7]=r("legend",null,"1.parse data",-1)),r("div",k,[i(h,{draggable:"","custom-request":F,limit:1,"show-retry-butto":!1,"show-cancel-button":!1,tip:"only support xls, xlsx format","file-list":s(S),accept:".xls, .xlsx, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},null,8,["file-list"])]),s(I).importKey?(f(),c("div",R,[r("div",g,[i(b,{size:"large"},{default:t((()=>[i(y,{title:"total rows",value:s(I).totalRows},null,8,["value"]),i(y,{title:"valid rows",value:s(I).validRows},null,8,["value"])])),_:1})]),r("div",U,[i(b,{size:"large"},{default:t((()=>[i(y,{title:"duplicate user",value:s(I).duplicateUserRows},null,8,["value"]),i(y,{title:"duplicate email",value:s(I).duplicateEmailRows},null,8,["value"]),i(y,{title:"duplicate phone",value:s(I).duplicatePhoneRows},null,8,["value"])])),_:1})])])):d("",!0)]),r("fieldset",null,[a[15]||(a[15]=r("legend",null,"2.import strategy",-1)),i(V,{label:"user already exists",field:"duplicateUser"},{default:t((()=>[i(x,{modelValue:s(z).duplicateUser,"onUpdate:modelValue":a[0]||(a[0]=e=>s(z).duplicateUser=e),type:"button"},{default:t((()=>[i(_,{value:1},{default:t((()=>a[8]||(a[8]=[n("skip this row")]))),_:1}),i(_,{value:3},{default:t((()=>a[9]||(a[9]=[n("stop import")]))),_:1}),i(_,{value:2},{default:t((()=>a[10]||(a[10]=[n("modify data")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),i(V,{label:"email already exists",field:"duplicateEmail"},{default:t((()=>[i(x,{modelValue:s(z).duplicateEmail,"onUpdate:modelValue":a[1]||(a[1]=e=>s(z).duplicateEmail=e),type:"button"},{default:t((()=>[i(_,{value:1},{default:t((()=>a[11]||(a[11]=[n("skip this row")]))),_:1}),i(_,{value:3},{default:t((()=>a[12]||(a[12]=[n("stop import")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),i(V,{label:"phone already exists",field:"duplicatePhone"},{default:t((()=>[i(x,{modelValue:s(z).duplicatePhone,"onUpdate:modelValue":a[2]||(a[2]=e=>s(z).duplicatePhone=e),type:"button"},{default:t((()=>[i(_,{value:1},{default:t((()=>a[13]||(a[13]=[n("skip this row")]))),_:1}),i(_,{value:3},{default:t((()=>a[14]||(a[14]=[n("stop import")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),i(V,{label:"default status",field:"defaultStatus"},{default:t((()=>[i(P,{modelValue:s(z).defaultStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>s(z).defaultStatus=e),"checked-value":1,"unchecked-value":2,"checked-text":"enable","unchecked-text":"disable",type:"round"},null,8,["modelValue"])])),_:1})])])),_:1},8,["model"])])),_:1},8,["visible","width"])}}}),[["__scopeId","data-v-e9f0f00f"]]);export{V as default};
