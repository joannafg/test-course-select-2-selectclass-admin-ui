import{b as e}from"./index-FaVgdj3V.js";import{g as s,u as t,a as l}from"./course-DukAjqW8.js";import{_ as a}from"./GiForm-BWZRNfN-.js";import{d as r,r as o,p as u,A as i,c as p,w as c,f as d,J as n,a as m,h,o as f,M as v}from"./index-BAyZi_co.js";import{u as y}from"./useResetReactive-NMdkdCz2.js";import{u as b}from"./useDept-CXLwDhMr.js";import{u as g}from"./useDict-ConFaTXJ.js";const w=r({__name:"CourseAddModal",emits:["save-success"],setup(r,{expose:w,emit:_}){const D=_,{width:j}=e(),q=o(""),I=o(!1),x=u((()=>!!q.value)),L=u((()=>x.value?"modify course":"add course")),C=o(),{course_type:R,course_status:k}=g("course_type","course_status"),{deptList:A,getDeptList:O}=b(),U={form:{size:"large"},btns:{hide:!0}},[V,z]=y({}),F=i([{label:"course ID",field:"courseNo",type:"input",props:{placeholder:"please enter the course ID"},rules:[{required:!0,message:"please enter the course ID"}]},{label:"course name",field:"name",type:"input",props:{placeholder:"please enter the course name"},rules:[{required:!0,message:"please enter the course name"}]},{label:"credit(10 points)",field:"credit",type:"input-number",props:{placeholder:"please enter the credit(10 points)"},rules:[{required:!0,message:"please enter the credit(10 points)"}]},{label:"hours",field:"hours",type:"input-number",props:{placeholder:"please enter the hours"},rules:[{required:!0,message:"please enter the hours"}]},{label:"type",field:"type",type:"select",props:{placeholder:"please select the type"},options:R,rules:[{required:!0,message:"please enter the type"}]},{label:"college ID",field:"collegeId",type:"tree-select",data:A,props:{placeholder:"please enter the college ID",allowClear:!0,allowSearch:!0,fallbackOption:!1,filterTreeNode:(e,s)=>!!s.title&&s.title.toLowerCase().includes(e.toLowerCase())},rules:[{required:!0,message:"please enter the college ID"}]},{label:"description",field:"description",type:"textarea",props:{placeholder:"please enter the description",autoSize:!0,maxLength:200,showWordLimit:!0}},{label:"status",field:"status",type:"select",props:{placeholder:"please select the status"},options:k,rules:[{required:!0,message:"please enter the status"}]}]),M=()=>{var e,s;null==(s=null==(e=C.value)?void 0:e.formRef)||s.resetFields(),z()},N=async()=>{var e,s;try{return!(await(null==(s=null==(e=C.value)?void 0:e.formRef)?void 0:s.validate()))&&(x.value?(await t(V,q.value),v.success("modify successfully")):(await l(V),v.success("add successfully")),D("save-success"),!0)}catch(a){return!1}};return w({onAdd:async()=>{await O(),M(),q.value="",I.value=!0},onUpdate:async e=>{M(),q.value=e;const{data:t}=await s(e);Object.assign(V,t),I.value=!0}}),(e,s)=>{const t=m("a-modal");return f(),p(t,{visible:d(I),"onUpdate:visible":s[1]||(s[1]=e=>n(I)?I.value=e:null),title:d(L),"mask-closable":!1,"esc-to-close":!1,width:d(j)>=600?600:"100%",draggable:"",onBeforeOk:N,onClose:M},{default:c((()=>[h(d(a),{ref_key:"formRef",ref:C,modelValue:d(V),"onUpdate:modelValue":s[0]||(s[0]=e=>n(V)?V.value=e:null),options:U,columns:d(F)},null,8,["modelValue","columns"])])),_:1},8,["visible","title","width"])}}});export{w as _};
