import{_ as e}from"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";import{d as l,p as a,a5 as o,r as s,A as d,aq as t,S as r,c as i,w as n,m as u,f,a as p,h as c,b as m,e as b,i as h,F as v,G as y,ah as _,I as k,R as g,a4 as V,C as w,t as x,o as C,x as $}from"./index-BAyZi_co.js";const q=$(l({__name:"GiForm",props:{modelValue:{},options:{default:()=>({})},columns:{}},emits:["update:modelValue","search","reset"],setup(l,{expose:$,emit:q}){var I;const F=l,j=q,E=a((()=>({grid:{cols:1},gridItem:{span:{xs:2,sm:1}},...F.options}))),R=o("formRef"),U=s((null==(I=F.options.fold)?void 0:I.defaultCollapsed)??!1),O=d({}),z=e=>{var l,a;return e<=((null==(l=F.options.fold)?void 0:l.index)||0)||e>=((null==(a=F.options.fold)?void 0:a.index)||0)&&!U.value},B=e=>{const l={};switch(e.type){case"input":case"input-password":case"input-number":l.allowClear=!0,l.placeholder=`请输入${e.label}`;break;case"textarea":l.placeholder=`请输入${e.label}`,l.maxLength=200;break;case"select":case"cascader":l.allowClear=!0,l.placeholder=`请选择${e.label}`,l.options=O[e.field]||e.options;break;case"tree-select":l.allowClear=!0,l.placeholder=`请选择${e.label}`,l.data=O[e.field]||e.data;break;case"radio-group":case"checkbox-group":l.options=O[e.field]||e.options;break;case"date-picker":l.placeholder="请选择日期";break;case"time-picker":l.allowClear=!0,l.placeholder="请选择时间"}return{...l,...e.props}},G=(e,l)=>{j("update:modelValue",Object.assign(F.modelValue,{[l]:e}))},P=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show(F.modelValue):void 0,A=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide(F.modelValue):void 0),L=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled(F.modelValue):void 0);F.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(F.modelValue).then((l=>{O[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const S=[];F.columns.forEach((e=>{var l;const a=S.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&S.push(e)}));const T=a((()=>t(F.modelValue)));return r(T,((e,l)=>{S.forEach((a=>{if(e[a.field]!==l[a.field]){F.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request(F.modelValue).then((e=>{O[l.field]=l.resultFormat?l.resultFormat(e):e.data,O[l.field].map((e=>e.value)).includes(F.modelValue[l.field])||j("update:modelValue",Object.assign(F.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(O[l.field]=[],j("update:modelValue",Object.assign(F.modelValue,{[l.field]:""})))}))}}))})),$({formRef:R}),(l,a)=>{const o=e,s=p("a-alert"),d=p("a-form-item"),t=p("a-grid-item"),r=p("icon-search"),$=p("a-button"),q=p("icon-refresh"),I=p("icon-up"),O=p("icon-down"),S=p("a-space"),T=p("a-grid"),D=p("a-form");return C(),i(D,u({ref_key:"formRef",ref:R,"auto-label-width":!0},f(E).form,{model:l.modelValue}),{default:n((()=>[c(T,u({class:"w-full","col-gap":8},f(E).grid,{collapsed:f(U)}),{default:n((()=>{var e,p;return[(C(!0),m(v,null,h(l.columns,((e,a)=>{var r;return C(),m(v,{key:e.field},[(void 0!==e.show?P(e):!A(e))?y((C(),i(t,u({key:0,ref_for:!0},e.gridItemProps||F.options.gridItem,{span:e.span||(null==(r=f(E).gridItem)?void 0:r.span)}),{default:n((()=>[c(d,u({ref_for:!0},e.formItemProps,{field:e.field,rules:e.rules,disabled:L(e)}),{label:n((()=>["string"==typeof e.label?(C(),m(v,{key:0},[w(x(e.label),1)],64)):(C(),i(g(e.label),{key:1}))])),default:n((()=>[["group-title"].includes(e.type||"")?k(l.$slots,"group-title",{key:1},(()=>[c(s,u({ref_for:!0},e.props),{default:n((()=>[w(x(e.label),1)])),_:2},1040)]),!0):k(l.$slots,e.field,u({key:0,ref_for:!0},{disabled:L(e)}),(()=>["range-picker"===e.type?(C(),i(o,u({key:0,ref_for:!0},e.props,{"model-value":l.modelValue[e.field],"onUpdate:modelValue":l=>G(l,e.field)}),null,16,["model-value","onUpdate:modelValue"])):(C(),i(g(`a-${e.type}`),u({key:1,ref_for:!0},B(e),{"model-value":l.modelValue[e.field],"onUpdate:modelValue":l=>G(l,e.field)}),V({_:2},[h(null==e?void 0:e.slots,((e,l)=>({name:l,fn:n((()=>["string"==typeof e?(C(),m(v,{key:0},[w(x(e),1)],64)):(C(),i(g(e),{key:1}))]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},1040,["field","rules","disabled"])])),_:2},1040,["span"])),[[_,z(a)]]):b("",!0)],64)})),128)),(null==(e=f(E).btns)?void 0:e.hide)?b("",!0):(C(),i(t,{key:0,suffix:null==(p=f(E).fold)?void 0:p.enable},{default:n((()=>[c(S,{wrap:"",size:[8,16],style:{"flex-wrap":"nowrap"}},{default:n((()=>[k(l.$slots,"suffix",{},(()=>{var e;return[c($,{type:"primary",onClick:a[0]||(a[0]=e=>j("search"))},{icon:n((()=>[c(r)])),default:n((()=>{var e;return[w(x((null==(e=f(E).btns)?void 0:e.searchBtnText)||"search"),1)]})),_:1}),c($,{onClick:a[1]||(a[1]=e=>j("reset"))},{icon:n((()=>[c(q)])),default:n((()=>a[3]||(a[3]=[w("reset")]))),_:1}),(null==(e=f(E).fold)?void 0:e.enable)?(C(),i($,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:a[2]||(a[2]=e=>U.value=!f(U))},{icon:n((()=>[f(U)?(C(),i(O,{key:1})):(C(),i(I,{key:0}))])),default:n((()=>[w(x(f(U)?"expand":"collapse"),1)])),_:1})):b("",!0)]}),!0)])),_:3})])),_:3},8,["suffix"]))]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-f7b0b740"]]);export{q as _};
