import{b as e}from"./index-FaVgdj3V.js";import{g as l,u as a}from"./role-C1QTvPIM.js";import{d as t,r as d,c as u,w as s,f as o,J as n,W as r,a as i,h as c,g as m,C as p,e as f,o as h,M as v,x as k}from"./index-BAyZi_co.js";import{u as V}from"./useResetReactive-NMdkdCz2.js";import{u as _}from"./useMenu-C8VM0Jot.js";import{u as b}from"./useDept-CXLwDhMr.js";import{u as y}from"./useDict-ConFaTXJ.js";const g=k(t({__name:"RoleUpdateDrawer",emits:["save-success"],setup(t,{expose:k,emit:g}){const x=g,{width:C}=e(),S=d(""),w=d(!1),U=d(),{data_scope_enum:j}=y("data_scope_enum"),{deptList:A,getDeptList:R}=b(),{menuList:M,getMenuList:N}=_(),I={name:[{required:!0,message:"please enter the name"}],code:[{required:!0,message:"please enter the code"}],dataScope:[{required:!0,message:"please select the data permission"}]},[D,L]=V({menuCheckStrictly:!0,deptCheckStrictly:!0,sort:999,dataScope:4}),q=d(),O=d(),T=d(!1),z=d(!0),E=d(!1),H=d(!1),B=()=>{var e,l,a,t,d;T.value=!1,E.value=!1,z.value=!0,H.value=!1,null==(e=q.value)||e.expandAll(T.value),null==(l=q.value)||l.checkAll(!1),null==(a=O.value)||a.expandAll(z.value),null==(t=O.value)||t.checkAll(!1),null==(d=U.value)||d.resetFields(),L()},F=e=>{var l,a;"menu"===e?null==(l=q.value)||l.expandAll(T.value):"dept"===e&&(null==(a=O.value)||a.expandAll(z.value))},J=e=>{var l,a;"menu"===e?null==(l=q.value)||l.checkAll(E.value):"dept"===e&&(null==(a=O.value)||a.checkAll(H.value))},W=async()=>{var e;try{return!(await(null==(e=U.value)?void 0:e.validate()))&&(D.menuIds=(()=>{var e,l;const a=(null==(e=q.value)?void 0:e.getCheckedNodes()).map((e=>e.key)),t=(null==(l=q.value)?void 0:l.getHalfCheckedNodes()).map((e=>e.key));return a.unshift(...t),a})(),D.deptIds=(()=>{var e,l;if(!O.value)return[];const a=(null==(e=O.value)?void 0:e.getCheckedNodes()).map((e=>e.key)),t=(null==(l=O.value)?void 0:l.getHalfCheckedNodes()).map((e=>e.key));return a.unshift(...t),a})(),await a(D,S.value),v.success("update successfully"),x("save-success"),!0)}catch(l){return!1}};return k({onOpen:async e=>{var a,t;B(),S.value=e,M.value.length||await N(),A.value.length||await R();const{data:d}=await l(e);Object.assign(D,d),null==(a=d.menuIds)||a.forEach((e=>{r((()=>{var l;null==(l=q.value)||l.checkNode(e,!0,!0)}))})),null==(t=d.deptIds)||t.forEach((e=>{r((()=>{var l;null==(l=O.value)||l.checkNode(e,!0,!0)}))})),w.value=!0}}),(e,l)=>{const a=i("a-input"),t=i("a-form-item"),d=i("a-input-number"),r=i("a-textarea"),v=i("a-checkbox"),k=i("a-space"),V=i("a-tree"),_=i("a-select"),b=i("a-form"),y=i("a-drawer");return h(),u(y,{visible:o(w),"onUpdate:visible":l[15]||(l[15]=e=>n(w)?w.value=e:null),title:"update role","mask-closable":!1,"esc-to-close":!1,width:o(C)>=600?600:"100%",onBeforeOk:W,onClose:B},{default:s((()=>[c(b,{ref_key:"formRef",ref:U,model:o(D),rules:I,size:"large","auto-label-width":""},{default:s((()=>[m("fieldset",null,[l[16]||(l[16]=m("legend",null,"basic information",-1)),c(t,{label:"name"},{default:s((()=>[c(a,{modelValue:o(D).name,"onUpdate:modelValue":l[0]||(l[0]=e=>o(D).name=e),modelModifiers:{trim:!0},placeholder:"please enter the name"},null,8,["modelValue"])])),_:1}),c(t,{label:"code"},{default:s((()=>[c(a,{modelValue:o(D).code,"onUpdate:modelValue":l[1]||(l[1]=e=>o(D).code=e),modelModifiers:{trim:!0},placeholder:"please enter the code",disabled:!0},null,8,["modelValue"])])),_:1}),c(t,{label:"sort"},{default:s((()=>[c(d,{modelValue:o(D).sort,"onUpdate:modelValue":l[2]||(l[2]=e=>o(D).sort=e),placeholder:"please enter the sort",min:1,mode:"button"},null,8,["modelValue"])])),_:1}),c(t,{label:"description"},{default:s((()=>[c(r,{modelValue:o(D).description,"onUpdate:modelValue":l[3]||(l[3]=e=>o(D).description=e),modelModifiers:{trim:!0},placeholder:"please enter the description","show-word-limit":"","max-length":200,"auto-size":{minRows:3,maxRows:5}},null,8,["modelValue"])])),_:1})]),m("fieldset",null,[l[20]||(l[20]=m("legend",null,"功能权限",-1)),c(t,{"hide-label":"",disabled:o(D).isSystem},{extra:s((()=>[c(V,{ref_key:"menuTreeRef",ref:q,class:"menu-tree",data:o(M),"default-expand-all":o(T),"check-strictly":!o(D).menuCheckStrictly,checkable:""},null,8,["data","default-expand-all","check-strictly"])])),default:s((()=>[c(k,null,{default:s((()=>[c(v,{modelValue:o(T),"onUpdate:modelValue":l[4]||(l[4]=e=>n(T)?T.value=e:null),onChange:l[5]||(l[5]=e=>F("menu"))},{default:s((()=>l[17]||(l[17]=[p("expand/collapse")]))),_:1},8,["modelValue"]),c(v,{modelValue:o(E),"onUpdate:modelValue":l[6]||(l[6]=e=>n(E)?E.value=e:null),onChange:l[7]||(l[7]=e=>J("menu"))},{default:s((()=>l[18]||(l[18]=[p("select all/unselect all")]))),_:1},8,["modelValue"]),c(v,{modelValue:o(D).menuCheckStrictly,"onUpdate:modelValue":l[8]||(l[8]=e=>o(D).menuCheckStrictly=e)},{default:s((()=>l[19]||(l[19]=[p("parent-child linkage")]))),_:1},8,["modelValue"])])),_:1})])),_:1},8,["disabled"])]),m("fieldset",null,[l[24]||(l[24]=m("legend",null,"data permission",-1)),c(t,{"hide-label":"",field:"dataScope"},{default:s((()=>[c(_,{modelValue:o(D).dataScope,"onUpdate:modelValue":l[9]||(l[9]=e=>o(D).dataScope=e),modelModifiers:{trim:!0},options:o(j),placeholder:"please select the data permission",disabled:o(D).isSystem},null,8,["modelValue","options","disabled"])])),_:1}),5===o(D).dataScope?(h(),u(t,{key:0,"hide-label":"",disabled:o(D).isSystem},{extra:s((()=>[c(V,{ref_key:"deptTreeRef",ref:O,data:o(A),"default-expand-all":o(z),"check-strictly":!o(D).deptCheckStrictly,checkable:""},null,8,["data","default-expand-all","check-strictly"])])),default:s((()=>[c(k,null,{default:s((()=>[c(v,{modelValue:o(z),"onUpdate:modelValue":l[10]||(l[10]=e=>n(z)?z.value=e:null),onChange:l[11]||(l[11]=e=>F("dept"))},{default:s((()=>l[21]||(l[21]=[p("expand/collapse")]))),_:1},8,["modelValue"]),c(v,{modelValue:o(H),"onUpdate:modelValue":l[12]||(l[12]=e=>n(H)?H.value=e:null),onChange:l[13]||(l[13]=e=>J("dept"))},{default:s((()=>l[22]||(l[22]=[p("select all/unselect all")]))),_:1},8,["modelValue"]),c(v,{modelValue:o(D).deptCheckStrictly,"onUpdate:modelValue":l[14]||(l[14]=e=>o(D).deptCheckStrictly=e)},{default:s((()=>l[23]||(l[23]=[p("parent-child linkage")]))),_:1},8,["modelValue"])])),_:1})])),_:1},8,["disabled"])):f("",!0)])])),_:1},8,["model"])])),_:1},8,["visible","width"])}}}),[["__scopeId","data-v-fd2f88e3"]]);export{g as default};
