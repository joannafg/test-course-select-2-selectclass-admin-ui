import{_ as e}from"./index-B7Sos0mo.js";import{_ as a}from"./GiCellTag.vue_vue_type_script_setup_true_lang-BFrLDIrR.js";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";import{d as o,A as s,ar as l,Z as n,a1 as i,r,B as d,j as u,b as m,h as c,w as p,f as h,a as g,G as _,c as f,C as j,e as y,M as b,a0 as k,o as x}from"./index-BAyZi_co.js";import{L as v,l as w,s as N,r as Y}from"./LogDetailDrawer-DB6r3cjQ.js";import{l as D}from"./job-DmHuDFqW.js";import{u as S}from"./useTable-DUTUCT70.js";import{u as B}from"./useDict-ConFaTXJ.js";import{h as V}from"./has-CF2CDZHh.js";import"./index-C-jnPPYH.js";import"./index-FaVgdj3V.js";import"./useBreakpoint-C2fvcUp5.js";const C={class:"gi_table_page"},I=o({name:"ScheduleLog",__name:"index",setup(o){const{job_execute_reason_enum:I,job_execute_status_enum:R}=B("job_execute_reason_enum","job_execute_status_enum"),O=s({datetimeRange:[l().subtract(6,"day").startOf("day").format("YYYY-MM-DD HH:mm:ss"),l().endOf("day").format("YYYY-MM-DD HH:mm:ss")]}),{tableData:M,pagination:q,loading:H,search:L}=S((e=>w({...O,...e})),{immediate:!1}),U=[{title:"序号",width:66,align:"center",render:({rowIndex:e})=>n("span",{},e+1+(q.current-1)*q.pageSize)},{title:"任务组",dataIndex:"groupName",minWidth:80,ellipsis:!0,tooltip:!0},{title:"任务名称",dataIndex:"jobName",minWidth:80,ellipsis:!0,tooltip:!0},{title:"调度时间",dataIndex:"createDt",width:180},{title:"执行状态",dataIndex:"taskBatchStatus",slotName:"taskBatchStatus",align:"center"},{title:"执行备注",dataIndex:"operationReason",slotName:"operationReason",minWidth:80,ellipsis:!0,tooltip:!0},{title:"执行时间",dataIndex:"executionAt",width:180},{title:"操作",slotName:"action",width:130,align:"center",fixed:i()?void 0:"right",show:V.hasPermOr(["schedule:log:detail","schedule:log:stop","schedule:log:retry"])}],W=r(),T=()=>{O.taskBatchStatus=void 0,O.datetimeRange=[l().subtract(6,"day").startOf("day").format("YYYY-MM-DD HH:mm:ss"),l().endOf("day").format("YYYY-MM-DD HH:mm:ss")],L()},z=r(),A=u();return d((()=>{A.query&&(O.jobId=A.query.jobId?Number.parseInt(A.query.jobId,10):void 0,O.groupName=A.query.groupName?A.query.groupName:void 0,O.jobName=A.query.jobName?A.query.jobName:void 0),(async()=>{const{data:e}=await D();W.value=null==e?void 0:e.map((e=>({label:e,value:e})))})(),L()})),(o,s)=>{const l=g("a-select"),n=g("a-input-search"),i=t,r=g("icon-refresh"),d=g("a-button"),u=a,w=g("a-link"),D=g("a-popconfirm"),S=g("a-space"),B=e,V=k("permission");return x(),m("div",C,[c(B,{title:"","row-key":"id",data:h(M),columns:U,loading:h(H),scroll:{x:"100%",y:"100%",minWidth:1300},pagination:h(q),"disabled-tools":["size"],onRefresh:h(L)},{"toolbar-left":p((()=>[c(l,{modelValue:h(O).groupName,"onUpdate:modelValue":s[0]||(s[0]=e=>h(O).groupName=e),placeholder:"请选择任务组",options:h(W),style:{width:"200px"},onChange:h(L)},null,8,["modelValue","options","onChange"]),c(n,{modelValue:h(O).jobName,"onUpdate:modelValue":s[1]||(s[1]=e=>h(O).jobName=e),placeholder:"搜索任务名称","allow-clear":"",onSearch:h(L)},null,8,["modelValue","onSearch"]),c(l,{modelValue:h(O).taskBatchStatus,"onUpdate:modelValue":s[2]||(s[2]=e=>h(O).taskBatchStatus=e),placeholder:"请选择状态",options:h(R),"allow-clear":"",style:{width:"150px"},onChange:h(L)},null,8,["modelValue","options","onChange"]),c(i,{modelValue:h(O).datetimeRange,"onUpdate:modelValue":s[3]||(s[3]=e=>h(O).datetimeRange=e),"allow-clear":!1,onChange:h(L)},null,8,["modelValue","onChange"]),c(d,{onClick:T},{icon:p((()=>[c(r)])),default:p((()=>s[4]||(s[4]=[j("重置")]))),_:1})])),taskBatchStatus:p((({record:e})=>[c(u,{value:e.taskBatchStatus,dict:h(R)},null,8,["value","dict"])])),operationReason:p((({record:e})=>[c(u,{value:e.operationReason,dict:h(I)},null,8,["value","dict"])])),action:p((({record:e})=>[c(S,null,{default:p((()=>[_((x(),f(w,{title:"详情",onClick:a=>(e=>{var a;null==(a=z.value)||a.onOpen(e)})(e)},{default:p((()=>s[5]||(s[5]=[j("详情")]))),_:2},1032,["onClick"])),[[V,["schedule:log:detail"]]]),c(D,{content:"是否确定停止本次执行?",type:"warning",onOk:a=>(e=>{N(e.id).then((()=>{b.success("停止成功")}))})(e)},{default:p((()=>[2===e.taskBatchStatus?_((x(),f(w,{key:0,status:"danger",title:"停止"},{default:p((()=>s[6]||(s[6]=[j("停止")]))),_:1})),[[V,["schedule:log:stop"]]]):y("",!0)])),_:2},1032,["onOk"]),c(D,{content:"是否确定重试本次执行?",type:"warning",onOk:a=>(e=>{Y(e.id).then((()=>{b.success("重试成功")}))})(e)},{default:p((()=>[4===e.taskBatchStatus||5===e.taskBatchStatus||6===e.taskBatchStatus?_((x(),f(w,{key:0,status:"danger",title:"重试"},{default:p((()=>s[7]||(s[7]=[j(" 重试 ")]))),_:1})),[[V,["schedule:log:retry"]]]):y("",!0)])),_:2},1032,["onOk"])])),_:2},1024)])),_:1},8,["data","loading","pagination","onRefresh"]),c(v,{ref_key:"LogDetailDrawerRef",ref:z},null,512)])}}});export{I as default};
