import{_ as e}from"./index-B7Sos0mo.js";import{_ as a}from"./GiCellStatus.vue_vue_type_script_setup_true_lang-27S6yIFO.js";import{_ as t}from"./GiCellGender.vue_vue_type_script_setup_true_lang-JUo4QZxx.js";import{d as l,A as i,Z as s,a1 as d,r as n,B as o,b as r,h as u,w as c,a as m,f as p,J as v,C as f,a4 as h,F as g,t as _,o as y,x as k}from"./index-BAyZi_co.js";import{l as x,a as w}from"./user-D7V0nsbJ.js";import{u as C}from"./useTable-DUTUCT70.js";import{u as I}from"./useDept-CXLwDhMr.js";const b={class:"container"},A=k(l({__name:"index",props:{multiple:{type:Boolean,default:!0},value:{default:()=>[]}},emits:["select-user"],setup(l,{expose:k,emit:A}){const S=l,N=A,j=i({sort:["t1.createTime,desc","t1.id,desc"]}),{tableData:z,loading:V,pagination:W,search:L}=C((e=>x({...j,...e})),{immediate:!0,formatResult:e=>e.map((e=>({...e,id:`${null==e?void 0:e.id}`,disabled:!1})))}),D=[{title:"序号",width:66,align:"center",render:({rowIndex:e})=>s("span",{},e+1+(W.current-1)*W.pageSize),fixed:d()?void 0:"left"},{title:"昵称",dataIndex:"nickname",slotName:"nickname",minWidth:140,ellipsis:!0,tooltip:!0,fixed:d()?void 0:"left"},{title:"用户名",dataIndex:"username",slotName:"username",minWidth:140,ellipsis:!0,tooltip:!0},{title:"状态",slotName:"status",align:"center"},{title:"性别",dataIndex:"gender",slotName:"gender",align:"center"},{title:"所属部门",dataIndex:"deptName",minWidth:180,ellipsis:!0,tooltip:!0},{title:"描述",dataIndex:"description",minWidth:130,ellipsis:!0,tooltip:!0}],E=[{title:"用户",dataIndex:"nickname",slotName:"nickname",minWidth:140,ellipsis:!0,tooltip:!0},{title:"操作",dataIndex:"action",slotName:"action",align:"center",width:90}],G={defaultPageSize:10,defaultSizeOptions:[10,20,30,40,50]},K=()=>{j.description=void 0,j.deptId=void 0,L()},R=n([]),T=n(new Map),U=()=>{N("select-user",R.value)},B=(e,a,t)=>{S.multiple?e.includes(a)?(T.value.set(a,t),R.value=Array.from(T.value.keys())):(T.value.delete(a),R.value=Array.from(T.value.keys())):(T.value.clear(),R.value=[],e.includes(a)&&(T.value.set(a,t),R.value=[a])),U()},$=e=>{e?(z.value.forEach((e=>{T.value.set(e.id,e)})),R.value=Array.from(T.value.keys())):(z.value.forEach((e=>{T.value.delete(e.id)})),R.value=Array.from(T.value.keys())),U()},q=()=>{T.value.clear(),R.value=[],U()},{deptList:F,getDeptList:J}=I(),M=(e,a)=>!!a.title&&a.title.toLowerCase().includes(e.toLowerCase());return o((async()=>{if(await J(),S.value&&S.value.length>0){const{data:e}=await w({userIds:S.value});if(S.multiple)e.map((e=>({...e,id:`${null==e?void 0:e.id}`,disabled:!1}))).forEach((e=>{S.value.includes(e.id)&&T.value.set(e.id,e)})),R.value=Array.from(T.value.keys());else{const a=e.find((e=>S.value[0]===e.id));a&&(T.value.set(a.id,a),R.value=[a.id])}}})),k({onClearSelected:q}),(l,i)=>{const s=m("a-input-search"),d=m("a-tree-select"),n=m("icon-refresh"),o=m("a-button"),k=m("a-space"),x=m("a-link"),w=m("a-alert"),C=t,I=a,A=e,N=m("a-col"),J=m("icon-delete"),O=m("a-table"),P=m("a-card"),Z=m("a-row");return y(),r("div",b,[u(Z,{gutter:16},{default:c((()=>[u(N,{span:24,md:17},{default:c((()=>[u(A,{selectedKeys:p(R),"onUpdate:selectedKeys":i[2]||(i[2]=e=>v(R)?R.value=e:null),"row-key":"id",data:p(z),columns:D,loading:p(V),scroll:{x:"100%",y:"100%",minWidth:500},style:{"max-height":"600px"},pagination:p(W),"disabled-tools":["size","fullscreen","setting","refresh"],"row-selection":{type:S.multiple?"checkbox":"radio",showCheckedAll:!0},onSelect:B,onSelectAll:$,onRefresh:p(L)},{top:c((()=>[u(k,{wrap:"",size:[8,8]},{default:c((()=>[u(s,{modelValue:p(j).description,"onUpdate:modelValue":i[0]||(i[0]=e=>p(j).description=e),placeholder:"搜索用户名/昵称/描述","allow-clear":"",onSearch:p(L)},null,8,["modelValue","onSearch"]),u(d,{modelValue:p(j).deptId,"onUpdate:modelValue":i[1]||(i[1]=e=>p(j).deptId=e),data:p(F),placeholder:"请选择所属部门","allow-clear":"","allow-search":"","filter-tree-node":M,onChange:p(L)},null,8,["modelValue","data","onChange"]),u(o,{onClick:K},{icon:c((()=>[u(n)])),default:c((()=>i[3]||(i[3]=[f("重置")]))),_:1})])),_:1}),u(w,null,h({default:c((()=>[p(R).length>0?(y(),r(g,{key:0},[f(" 已选中 "+_(p(R).length)+" 条记录(可跨页) ",1)],64)):(y(),r(g,{key:1},[f("未选中任何记录")],64))])),_:2},[p(R).length>0?{name:"action",fn:c((()=>[u(x,{onClick:q},{default:c((()=>i[4]||(i[4]=[f("清空")]))),_:1})])),key:"0"}:void 0]),1024)])),gender:c((({record:e})=>[u(C,{gender:e.gender},null,8,["gender"])])),status:c((({record:e})=>[u(I,{status:e.status},null,8,["status"])])),_:1},8,["selectedKeys","data","loading","pagination","row-selection","onRefresh"])])),_:1}),u(N,{span:24,md:7,class:"section"},{default:c((()=>[u(P,null,{title:c((()=>[f("已选择: "+_(p(R).length),1)])),default:c((()=>[u(O,{columns:E,data:[...p(T).values()],pagination:G},{nickname:c((({record:e})=>[f(_(e.nickname)+"("+_(e.username)+") ",1)])),action:c((({record:e})=>[u(o,{status:"danger",size:"mini",onClick:a=>{return t=e,T.value.delete(t.id),R.value=Array.from(T.value.keys()),void U();var t}},{default:c((()=>[u(J)])),_:2},1032,["onClick"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-4b07fda0"]]);export{A as _};
