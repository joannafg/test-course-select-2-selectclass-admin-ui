import{_ as e}from"./index-B7Sos0mo.js";import{b as l}from"./index-FaVgdj3V.js";import{b as a,c as o,e as t,s as d}from"./generator-Iuzxk3cN.js";import{_ as u}from"./GiForm-BWZRNfN-.js";import{d as s,r as i,A as n,c as r,w as m,f as p,J as c,a as f,h as y,b as v,C as h,o as w,M as V,x as _}from"./index-BAyZi_co.js";import{u as g}from"./useResetReactive-NMdkdCz2.js";import{u as b}from"./useDict-ConFaTXJ.js";import"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";const U={key:1},k={key:1},N=_(s({__name:"GenConfigDrawer",emits:["save-success"],setup(s,{expose:_,emit:N}){const T=N,{width:I}=l(),q=i(""),x=i(!1),L=i("1"),C=i(),{form_type_enum:D,query_type_enum:F}=b("form_type_enum","query_type_enum"),j=i([]),R={form:{size:"large"},grid:{cols:2},btns:{hide:!0}},[O,Q]=g({isOverride:!1}),B=n([{label:"作者名称",field:"author",type:"input",rules:[{required:!0,message:"请输入作者名称"}]},{label:"业务名称",field:"businessName",type:"input",props:{placeholder:"自定义业务名称，例如：用户"},rules:[{required:!0,message:"请输入业务名称"}]},{label:"所属模块",field:"moduleName",type:"input",props:{placeholder:"项目模块名称，例如：continew-system"},rules:[{required:!0,message:"请输入所属模块"}]},{label:"模块包名",field:"packageName",type:"input",props:{placeholder:"项目模块包名，例如：top.continew.admin.system"},rules:[{required:!0,message:"请输入模块包名"}]},{label:"去表前缀",field:"tablePrefix",type:"input",props:{placeholder:"数据库表前缀，例如：sys_",width:"200"}},{label:"是否覆盖",field:"isOverride",type:"switch",props:{type:"round",checkedValue:!0,uncheckedValue:!1,checkedText:"是",uncheckedText:"否"}}]),$=i([]),z=i(!1),G=async(e,l)=>{try{z.value=!0;const{data:a}=await t(e,l);$.value=a}finally{z.value=!1}},S=[{title:"名称",slotName:"fieldName"},{title:"类型",slotName:"fieldType"},{title:"描述",slotName:"comment",width:170},{title:"列表",slotName:"showInList",width:60,align:"center"},{title:"表单",slotName:"showInForm",width:60,align:"center"},{title:"必填",slotName:"isRequired",width:60,align:"center"},{title:"查询",slotName:"showInQuery",width:60,align:"center"},{title:"表单类型",slotName:"formType"},{title:"查询方式",slotName:"queryType"},{title:"关联字典",slotName:"dictCode"}],A=()=>{var e,l;null==(l=null==(e=C.value)?void 0:e.formRef)||l.resetFields(),Q()},J=e=>{$.value=e},K=async()=>{var e,l;try{return await(null==(l=null==(e=C.value)?void 0:e.formRef)?void 0:l.validate())?(L.value="1",!1):(await d(O.tableName,{genConfig:O,fieldConfigs:$.value}),V.success("保存成功"),T("save-success"),!0)}catch(a){return!1}};return _({onOpen:async(e,l)=>{A(),l=l?`（${l}）`:" ",q.value=`${e}${l}配置`;const{data:t}=await a(e);Object.assign(O,t),O.isOverride=O.isOverride||!1,x.value=!0,await G(e,!1);const d=await o();j.value=d.data}}),(l,a)=>{const o=f("a-tab-pane"),t=f("icon-sync"),d=f("a-button"),s=f("a-tooltip"),i=f("a-popconfirm"),n=f("a-input"),V=f("a-option"),_=f("a-select"),g=f("a-checkbox"),b=e,N=f("a-tabs"),T=f("a-drawer");return w(),r(T,{visible:p(x),"onUpdate:visible":a[3]||(a[3]=e=>c(x)?x.value=e:null),title:p(q),"mask-closable":!1,"esc-to-close":!1,width:p(I)>=1350?1350:"100%",onBeforeOk:K,onClose:A},{default:m((()=>[y(N,{"active-key":p(L),"onUpdate:activeKey":a[2]||(a[2]=e=>c(L)?L.value=e:null)},{default:m((()=>[y(o,{key:"1",title:"生成配置"},{default:m((()=>[y(p(u),{ref_key:"formRef",ref:C,modelValue:p(O),"onUpdate:modelValue":a[0]||(a[0]=e=>c(O)?O.value=e:null),options:R,columns:p(B)},null,8,["modelValue","columns"])])),_:1}),y(o,{key:"2",title:"字段配置"},{default:m((()=>[y(b,{"row-key":"tableName",data:p($),columns:S,loading:p(z),scroll:{x:"100%",y:800,minWidth:900},pagination:!1,draggable:{type:"handle",width:40},"disabled-tools":["setting","refresh"],"disabled-column-keys":["tableName"],onChange:J},{"toolbar-left":m((()=>[y(i,{content:"是否确定同步最新数据表结构？同步后只要不点击确定保存，则不影响原有配置数据。",type:"warning",onOk:a[1]||(a[1]=e=>(async e=>{await G(e,!0)})(p(O).tableName))},{default:m((()=>[y(s,{content:"同步最新数据表结构"},{default:m((()=>[y(d,{type:"primary",status:"success",size:"small",title:"同步",disabled:0!==p($).length&&null==p($)[0].createTime},{icon:m((()=>[y(t)])),default:m((()=>[a[4]||(a[4]=h("同步 "))])),_:1},8,["disabled"])])),_:1})])),_:1})])),fieldName:m((({record:e})=>[y(n,{modelValue:e.fieldName,"onUpdate:modelValue":l=>e.fieldName=l},null,8,["modelValue","onUpdate:modelValue"])])),fieldType:m((({record:e})=>[y(_,{modelValue:e.fieldType,"onUpdate:modelValue":l=>e.fieldType=l,placeholder:"请选择字段类型","allow-search":"","allow-create":"",error:!e.fieldType},{default:m((()=>[y(V,{value:"String"},{default:m((()=>a[5]||(a[5]=[h("String")]))),_:1}),y(V,{value:"Integer"},{default:m((()=>a[6]||(a[6]=[h("Integer")]))),_:1}),y(V,{value:"Long"},{default:m((()=>a[7]||(a[7]=[h("Long")]))),_:1}),y(V,{value:"Float"},{default:m((()=>a[8]||(a[8]=[h("Float")]))),_:1}),y(V,{value:"Double"},{default:m((()=>a[9]||(a[9]=[h("Double")]))),_:1}),y(V,{value:"Boolean"},{default:m((()=>a[10]||(a[10]=[h("Boolean")]))),_:1}),y(V,{value:"BigDecimal"},{default:m((()=>a[11]||(a[11]=[h("BigDecimal")]))),_:1}),y(V,{value:"LocalDate"},{default:m((()=>a[12]||(a[12]=[h("LocalDate")]))),_:1}),y(V,{value:"LocalTime"},{default:m((()=>a[13]||(a[13]=[h("LocalTime")]))),_:1}),y(V,{value:"LocalDateTime"},{default:m((()=>a[14]||(a[14]=[h("LocalDateTime")]))),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","error"])])),comment:m((({record:e})=>[y(n,{modelValue:e.comment,"onUpdate:modelValue":l=>e.comment=l},null,8,["modelValue","onUpdate:modelValue"])])),showInList:m((({record:e})=>[y(g,{modelValue:e.showInList,"onUpdate:modelValue":l=>e.showInList=l,value:"true"},null,8,["modelValue","onUpdate:modelValue"])])),showInForm:m((({record:e})=>[y(g,{modelValue:e.showInForm,"onUpdate:modelValue":l=>e.showInForm=l,value:"true"},null,8,["modelValue","onUpdate:modelValue"])])),isRequired:m((({record:e})=>[e.showInForm?(w(),r(g,{key:0,modelValue:e.isRequired,"onUpdate:modelValue":l=>e.isRequired=l,value:"true"},null,8,["modelValue","onUpdate:modelValue"])):(w(),r(g,{key:1,disabled:""}))])),showInQuery:m((({record:e})=>[y(g,{modelValue:e.showInQuery,"onUpdate:modelValue":l=>e.showInQuery=l,value:"true"},null,8,["modelValue","onUpdate:modelValue"])])),formType:m((({record:e})=>[e.showInForm||e.showInQuery?(w(),r(_,{key:0,modelValue:e.formType,"onUpdate:modelValue":l=>e.formType=l,options:p(D),"default-value":1,placeholder:"请选择表单类型"},null,8,["modelValue","onUpdate:modelValue","options"])):(w(),v("span",U,"无需设置"))])),queryType:m((({record:e})=>[e.showInQuery?(w(),r(_,{key:0,modelValue:e.queryType,"onUpdate:modelValue":l=>e.queryType=l,options:p(F),"default-value":1,placeholder:"请选择查询方式"},null,8,["modelValue","onUpdate:modelValue","options"])):(w(),v("span",k,"无需设置"))])),dictCode:m((({record:e})=>[y(_,{modelValue:e.dictCode,"onUpdate:modelValue":l=>e.dictCode=l,options:p(j),placeholder:"请选择字典类型","allow-search":"","allow-clear":""},null,8,["modelValue","onUpdate:modelValue","options"])])),_:1},8,["data","loading"])])),_:1})])),_:1},8,["active-key"])])),_:1},8,["visible","title","width"])}}}),[["__scopeId","data-v-79e54229"]]);export{N as default};
