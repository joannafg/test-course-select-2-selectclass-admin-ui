import{_ as e}from"./index-B7Sos0mo.js";import{_ as t}from"./index-5q-8k9YQ.js";import{d as a,A as o,ar as i,r,b as s,h as l,a4 as n,w as d,f as m,F as p,a as c,C as u,t as f,c as g,g as h,G as x,a0 as _,o as y,Z as k}from"./index-BAyZi_co.js";import T from"./OperationLogDetailDrawer-B4KEpkx7.js";import{l as Y,a as w}from"./log-Zo2beUmC.js";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";import{u as I}from"./useTable-DUTUCT70.js";import{u as b}from"./useDownload-C-k5xGNE.js";import{h as v}from"./has-CF2CDZHh.js";const C=a({name:"OperationLog",__name:"index",setup(a){const C=o({createTime:[i().subtract(6,"day").startOf("day").format("YYYY-MM-DD HH:mm:ss"),i().endOf("day").format("YYYY-MM-DD HH:mm:ss")],sort:["createTime,desc"]}),{loading:j,tableData:H,pagination:M,search:O}=I((e=>Y({...C,...e})),{immediate:!0}),V=[{title:"序号",width:66,align:"center",render:({rowIndex:e})=>k("span",{},e+1+(M.current-1)*M.pageSize)},{title:"operation time",dataIndex:"createTime",slotName:"createTime",width:180},{title:"operation user",dataIndex:"createUserString",ellipsis:!0,tooltip:!0},{title:"operation content",dataIndex:"description",ellipsis:!0,tooltip:!0},{title:"module",dataIndex:"module",align:"center",ellipsis:!0,tooltip:!0},{title:"status",dataIndex:"status",slotName:"status",align:"center",filterable:{filters:[{text:"success",value:"1"},{text:"failed",value:"2"}],filter:()=>!0,alignLeft:!0}},{title:"operation IP",dataIndex:"ip",ellipsis:!0,tooltip:!0},{title:"operation location",dataIndex:"address",ellipsis:!0,tooltip:!0},{title:"time taken",dataIndex:"timeTaken",slotName:"timeTaken",align:"center"},{title:"browser",dataIndex:"browser",ellipsis:!0,tooltip:!0},{title:"terminal system",dataIndex:"os",ellipsis:!0,tooltip:!0}],U=()=>{C.description=void 0,C.ip=void 0,C.createUserString=void 0,C.createTime=[i().subtract(6,"day").startOf("day").format("YYYY-MM-DD HH:mm:ss"),i().endOf("day").format("YYYY-MM-DD HH:mm:ss")],C.status=void 0,O()},S=(e,t)=>{try{const a=V[e.split("_").pop()].slotName;C[a]=t.join(","),O()}catch(a){O()}},L=()=>{b((()=>w(C)))},N=r();return(a,o)=>{const i=c("icon-search"),r=c("a-input"),k=c("icon-refresh"),Y=c("a-button"),w=c("icon-download"),I=c("a-link"),b=t,z=c("a-tag"),P=c("a-tooltip"),R=e,F=_("permission");return y(),s(p,null,[l(R,{"row-key":"id",data:m(H),columns:V,loading:m(j),scroll:{x:"100%",y:"100%",minWidth:1e3},pagination:m(M),"column-resizable":"","disabled-tools":["size","setting"],onFilterChange:S,onRefresh:m(O)},n({"toolbar-left":d((()=>[l(r,{modelValue:m(C).createUserString,"onUpdate:modelValue":o[0]||(o[0]=e=>m(C).createUserString=e),placeholder:"search operation user","allow-clear":"",onChange:m(O)},{prefix:d((()=>[l(i)])),_:1},8,["modelValue","onChange"]),l(r,{modelValue:m(C).ip,"onUpdate:modelValue":o[1]||(o[1]=e=>m(C).ip=e),placeholder:"search operation IP or location","allow-clear":"",onChange:m(O)},{prefix:d((()=>[l(i)])),_:1},8,["modelValue","onChange"]),l(D,{modelValue:m(C).createTime,"onUpdate:modelValue":o[2]||(o[2]=e=>m(C).createTime=e),onChange:m(O)},null,8,["modelValue","onChange"]),l(Y,{onClick:U},{icon:d((()=>[l(k)])),default:d((()=>o[3]||(o[3]=[u("reset")]))),_:1})])),"toolbar-right":d((()=>[x((y(),g(Y,{onClick:L},{icon:d((()=>[l(w)])),default:d((()=>o[4]||(o[4]=[u("export")]))),_:1})),[[F,["monitor:log:export"]]])])),status:d((({record:e})=>[1===e.status?(y(),g(z,{key:0,color:"green"},{default:d((()=>[l(b,{type:"success",style:{width:"5px",height:"5px"}}),o[5]||(o[5]=h("span",{style:{"margin-left":"5px"}},"success",-1))])),_:1})):(y(),g(P,{key:1,content:e.errorMsg},{default:d((()=>[l(z,{color:"red",style:{cursor:"pointer"}},{default:d((()=>[l(b,{type:"danger",style:{width:"5px",height:"5px"}}),o[6]||(o[6]=h("span",{style:{"margin-left":"5px"}},"failed",-1))])),_:1})])),_:2},1032,["content"]))])),timeTaken:d((({record:e})=>[e.timeTaken>500?(y(),g(z,{key:0,color:"red"},{default:d((()=>[u(f(e.timeTaken)+"ms",1)])),_:2},1024)):e.timeTaken>200?(y(),g(z,{key:1,color:"orange"},{default:d((()=>[u(f(e.timeTaken)+"ms",1)])),_:2},1024)):(y(),g(z,{key:2,color:"green"},{default:d((()=>[u(f(e.timeTaken)+" ms",1)])),_:2},1024))])),_:2},[m(v).hasPermOr(["monitor:log:detail"])?{name:"createTime",fn:d((({record:e})=>[l(I,{onClick:t=>{return a=e,void(null==(o=N.value)||o.onOpen(a.id));var a,o}},{default:d((()=>[u(f(e.createTime),1)])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["data","loading","pagination","onRefresh"]),l(T,{ref_key:"OperationLogDetailDrawerRef",ref:N},null,512)],64)}}});export{C as _};
