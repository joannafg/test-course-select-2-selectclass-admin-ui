import{b as e}from"./index-FaVgdj3V.js";import{$ as l,d as a,r as t,p as d,aU as s,c as o,w as n,f as u,J as r,a as i,h as m,e as c,b as p,g as f,t as h,o as y,M as b}from"./index-BAyZi_co.js";import{u as V}from"./useResetReactive-NMdkdCz2.js";import{u as k}from"./useDict-ConFaTXJ.js";import{e as v}from"./encrypt-fe7GwHAY.js";const g="/system/storage";function _(e){return l.get(`${g}`,e)}function w(e){return l.del(`${g}/${e}`)}const U={key:0},$=a({__name:"StorageAddDrawer",emits:["save-success"],setup(a,{expose:_,emit:w}){const $=w,{width:x}=e(),K=t(""),M=t(!1),q=d((()=>!!K.value)),j=d((()=>q.value?"update storage":"add storage")),D=t(),{storage_type_enum:N}=k("storage_type_enum"),R={name:[{required:!0,message:"please enter the name"}],code:[{required:!0,message:"please enter the code"}],type:[{required:!0,message:"please select the type"}],accessKey:[{required:!0,message:"please enter the access key"}],secretKey:[{required:!0,message:"please enter the secret key"}],endpoint:[{required:!0,message:"please enter the endpoint"}],bucketName:[{required:!0,message:"please enter the bucket name"}]},[z,A]=V({type:2,isDefault:!1,sort:999,status:1}),O=d((()=>{const{endpoint:e,bucketName:l,domain:a,type:t}=z;if(a||1!==t||!e||!l)return;const{endpoint:d,protocol:o}=(n=e).startsWith("http://")?{endpoint:n.substring(7),protocol:"http://"}:n.startsWith("https://")?{endpoint:n.substring(8),protocol:"https://"}:{endpoint:n,protocol:"http://"};var n;return s(d)?`${o}${d}/${l}/`:`${o}${l}.${d}/`})),W=()=>{var e;null==(e=D.value)||e.resetFields(),A()},B=async()=>{var e;try{if(await(null==(e=D.value)?void 0:e.validate()))return!1;const a={...z,secretKey:1!==z.type||z.secretKey.includes("*")?null:v(z.secretKey),domain:z.domain||O.value};return q.value?(await function(e,a){return l.put(`${g}/${a}`,e)}(a,K.value),b.success("update successfully")):(await function(e){return l.post(`${g}`,e)}(a),b.success("add successfully")),$("save-success"),!0}catch(a){return!1}};return _({onAdd:()=>{W(),K.value="",M.value=!0},onUpdate:async e=>{W(),K.value=e;const{data:a}=await function(e){return l.get(`${g}/${e}`)}(e);Object.assign(z,a),M.value=!0}}),(e,l)=>{const a=i("a-input"),t=i("a-form-item"),d=i("a-select"),s=i("a-input-number"),b=i("a-textarea"),V=i("a-switch"),k=i("a-form"),v=i("a-drawer");return y(),o(v,{visible:u(M),"onUpdate:visible":l[13]||(l[13]=e=>r(M)?M.value=e:null),title:u(j),"mask-closable":!1,"esc-to-close":!1,width:u(x)>=600?600:"100%",onBeforeOk:B,onClose:W},{default:n((()=>[m(k,{ref_key:"formRef",ref:D,model:u(z),rules:R,size:"large","auto-label-width":""},{default:n((()=>[m(t,{label:"name",field:"name"},{default:n((()=>[m(a,{modelValue:u(z).name,"onUpdate:modelValue":l[0]||(l[0]=e=>u(z).name=e),modelModifiers:{trim:!0},placeholder:"please enter the name"},null,8,["modelValue"])])),_:1}),m(t,{label:"code",field:"code"},{default:n((()=>[m(a,{modelValue:u(z).code,"onUpdate:modelValue":l[1]||(l[1]=e=>u(z).code=e),modelModifiers:{trim:!0},placeholder:"please enter the code",disabled:u(q)},null,8,["modelValue","disabled"])])),_:1}),m(t,{label:"type",field:"type"},{default:n((()=>[m(d,{modelValue:u(z).type,"onUpdate:modelValue":l[2]||(l[2]=e=>u(z).type=e),modelModifiers:{trim:!0},options:u(N),placeholder:"please select the type",disabled:u(q)},null,8,["modelValue","options","disabled"])])),_:1}),1===u(z).type?(y(),o(t,{key:0,label:"access key",field:"accessKey"},{default:n((()=>[m(a,{modelValue:u(z).accessKey,"onUpdate:modelValue":l[3]||(l[3]=e=>u(z).accessKey=e),modelModifiers:{trim:!0},placeholder:"please enter the access key","max-length":255},null,8,["modelValue"])])),_:1})):c("",!0),1===u(z).type?(y(),o(t,{key:1,label:"secret key",field:"secretKey"},{default:n((()=>[m(a,{modelValue:u(z).secretKey,"onUpdate:modelValue":l[4]||(l[4]=e=>u(z).secretKey=e),modelModifiers:{trim:!0},placeholder:"please enter the secret key","max-length":255},null,8,["modelValue"])])),_:1})):c("",!0),1===u(z).type?(y(),o(t,{key:2,label:"endpoint",field:"endpoint"},{default:n((()=>[m(a,{modelValue:u(z).endpoint,"onUpdate:modelValue":l[5]||(l[5]=e=>u(z).endpoint=e),modelModifiers:{trim:!0},placeholder:"please enter the endpoint"},null,8,["modelValue"])])),_:1})):c("",!0),m(t,{label:"bucket name",field:"bucketName"},{default:n((()=>[m(a,{modelValue:u(z).bucketName,"onUpdate:modelValue":l[6]||(l[6]=e=>u(z).bucketName=e),modelModifiers:{trim:!0},placeholder:"please enter the bucket name"},null,8,["modelValue"])])),_:1}),1===u(z).type?(y(),o(t,{key:3,label:"domain",field:"domain"},{extra:n((()=>[u(O)?(y(),p("div",U,[f("span",null,"leave blank for default domain: "+h(u(O)),1)])):c("",!0)])),default:n((()=>[m(a,{modelValue:u(z).domain,"onUpdate:modelValue":l[7]||(l[7]=e=>u(z).domain=e),modelModifiers:{trim:!0},placeholder:"please enter the domain"},null,8,["modelValue"])])),_:1})):c("",!0),2===u(z).type?(y(),o(t,{key:4,label:"domain",field:"domain",rules:[{required:!0,message:"please enter the domain"}]},{default:n((()=>[m(a,{modelValue:u(z).domain,"onUpdate:modelValue":l[8]||(l[8]=e=>u(z).domain=e),modelModifiers:{trim:!0},placeholder:"please enter the domain"},null,8,["modelValue"])])),_:1})):c("",!0),m(t,{label:"sort",field:"sort"},{default:n((()=>[m(s,{modelValue:u(z).sort,"onUpdate:modelValue":l[9]||(l[9]=e=>u(z).sort=e),placeholder:"please enter the sort",min:1,mode:"button"},null,8,["modelValue"])])),_:1}),m(t,{label:"description",field:"description"},{default:n((()=>[m(b,{modelValue:u(z).description,"onUpdate:modelValue":l[10]||(l[10]=e=>u(z).description=e),modelModifiers:{trim:!0},placeholder:"please enter the description","show-word-limit":"","max-length":200,"auto-size":{minRows:3,maxRows:5}},null,8,["modelValue"])])),_:1}),m(t,{label:"default storage",field:"isDefault"},{default:n((()=>[m(V,{modelValue:u(z).isDefault,"onUpdate:modelValue":l[11]||(l[11]=e=>u(z).isDefault=e),type:"round","checked-value":!0,"unchecked-value":!1,"checked-text":"yes","unchecked-text":"no"},null,8,["modelValue"])])),_:1}),m(t,{label:"status",field:"status"},{default:n((()=>[m(V,{modelValue:u(z).status,"onUpdate:modelValue":l[12]||(l[12]=e=>u(z).status=e),type:"round","checked-value":1,"unchecked-value":2,"checked-text":"enable","unchecked-text":"disable"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","width"])}}});export{$ as _,w as d,_ as l};
