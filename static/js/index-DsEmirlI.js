import{_ as e}from"./index-CK_656P1.js";import{b as t}from"./index-FaVgdj3V.js";import s from"./index-DpBew6pY.js";import{g as a,u as l,a as i}from"./notice-GOHHkgAo.js";import{d as o,j as r,p as n,r as u,A as c,B as p,aS as d,b as m,g as f,h as v,w as y,f as _,a as b,J as g,C as h,t as j,c as U,e as k,k as x,M as w,o as S}from"./index-BAyZi_co.js";import{_ as V}from"./GiForm-BWZRNfN-.js";import{u as C}from"./useResetReactive-NMdkdCz2.js";import{u as T}from"./useDict-ConFaTXJ.js";import{u as R}from"./tabs-D4ctZ4n_.js";import"./index-B7Sos0mo.js";import"./GiCellStatus.vue_vue_type_script_setup_true_lang-27S6yIFO.js";import"./GiCellGender.vue_vue_type_script_setup_true_lang-JUo4QZxx.js";import"./user-D7V0nsbJ.js";import"./useTable-DUTUCT70.js";import"./useBreakpoint-C2fvcUp5.js";import"./useDept-CXLwDhMr.js";import"./style-CMZ46hYP.js";import"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";const q={class:"detail_header"},G={class:"detail_content",style:{display:"flex","flex-direction":"column"}},B={style:{flex:"1"}},D=o({__name:"index",setup(o){const{width:D}=t(),F=r(),L=x(),z=R(),{id:A,type:H}=F.query,J=n((()=>"update"===H)),M=n((()=>J.value?"修改":"新增")),N=u(),O=u(),{notice_type:W}=T("notice_type"),$={form:{size:"large"},grid:{cols:2},btns:{hide:!0}},[E,I]=C({title:"",type:"",effectiveTime:"",terminateTime:"",content:"",noticeScope:1}),K=c([{label:"title",field:"title",type:"input",props:{maxLength:150,showWordLimit:!0},rules:[{required:!0,message:"please enter the title"}]},{label:"type",field:"type",type:"select",options:W,rules:[{required:!0,message:"please enter the type"}]},{label:"effective time",field:"effectiveTime",type:"date-picker",props:{showTime:!0}},{label:"terminate time",field:"terminateTime",type:"date-picker",props:{showTime:!0}},{label:"notice scope",field:"noticeScope",type:"radio-group",options:[{label:"all",value:1},{label:"specified user",value:2}],rules:[{required:!0,message:"please select the notice scope"}]},{label:"specified user",field:"noticeUsers",type:"select",hide:()=>1===E.noticeScope,rules:[{required:!0,message:"please select the specified user"}]}]),P=()=>{L.back(),z.closeCurrent(F.path)},Q=async()=>{var e,t;if(await(null==(t=null==(e=O.value)?void 0:e.formRef)?void 0:t.validate()))return!1;try{return E.noticeUsers=1===E.noticeScope?null:E.noticeUsers,J.value?(await l(E,A),w.success("modify successfully")):(await i(E),w.success("add successfully")),P(),!0}catch(s){return!1}},X=u(!1),Y=()=>{X.value=!0},Z=u(),ee=()=>{var e;null==(e=Z.value)||e.onClearSelected()},te=e=>{var t,s;E.noticeUsers=e,null==(s=null==(t=O.value)?void 0:t.formRef)||s.validateField("noticeUsers")},se=u([]);return p((async()=>{A&&J.value&&await(async e=>{I();const t=await a(e);Object.assign(E,t.data)})(A);const{data:e}=await d();se.value=e.map((e=>({...e,value:`${e.value}`})))})),(t,a)=>{const l=b("icon-save"),i=b("icon-send"),o=b("a-button"),r=b("a-page-header"),n=b("a-affix"),u=b("a-select"),c=b("icon-plus"),p=b("a-tooltip"),d=e,x=b("a-modal");return S(),m("div",{ref_key:"containerRef",ref:N,class:"detail"},[f("div",q,[v(n,{target:_(N)},{default:y((()=>[v(r,{title:"notice",subtitle:_(M),onBack:P},{extra:y((()=>[v(o,{type:"primary",onClick:Q},{icon:y((()=>[_(J)?(S(),U(l,{key:0})):(S(),U(i,{key:1}))])),default:y((()=>[h(j(_(J)?"save":"publish"),1)])),_:1})])),_:1},8,["subtitle"])])),_:1},8,["target"])]),f("div",G,[v(_(V),{ref_key:"formRef",ref:O,modelValue:_(E),"onUpdate:modelValue":a[1]||(a[1]=e=>g(E)?E.value=e:null),options:$,columns:_(K)},{noticeUsers:y((()=>[v(u,{modelValue:_(E).noticeUsers,"onUpdate:modelValue":a[0]||(a[0]=e=>_(E).noticeUsers=e),options:_(se),multiple:"","max-tag-count":4,"allow-clear":!0},null,8,["modelValue","options"]),v(p,{content:"select user"},{default:y((()=>[v(o,{onClick:Y},{icon:y((()=>[v(c)])),_:1})])),_:1})])),_:1},8,["modelValue","columns"]),f("div",B,[v(s,{modelValue:_(E).content,"onUpdate:modelValue":a[2]||(a[2]=e=>_(E).content=e)},null,8,["modelValue"])])]),v(x,{visible:_(X),"onUpdate:visible":a[4]||(a[4]=e=>g(X)?X.value=e:null),title:"用户选择","mask-closable":!1,"esc-to-close":!1,width:_(D)>=1100?1100:"100%",draggable:"",onClose:ee},{default:y((()=>[_(X)?(S(),U(d,{key:0,ref_key:"UserSelectRef",ref:Z,value:_(E).noticeUsers,"onUpdate:value":a[3]||(a[3]=e=>_(E).noticeUsers=e),onSelectUser:te},null,8,["value"])):k("",!0)])),_:1},8,["visible","width"])],512)}}});export{D as default};
