import{d as e,r as a,p as s,B as t,b as o,g as l,h as i,G as r,w as n,J as c,f as d,a as u,c as p,z as m,W as v,e as _,C as y,t as f,O as g,M as h,a0 as w,o as k,x as j}from"./index-BAyZi_co.js";import{_ as x}from"./DictAddModal.vue_vue_type_script_setup_true_lang-BJNiHYfC.js";import b from"./RightMenu-ylQe2XAf.js";import{b as C,c as M}from"./dict-BKgVatZ-.js";import{h as O}from"./has-CF2CDZHh.js";import"./index-FaVgdj3V.js";import"./GiForm-BWZRNfN-.js";import"./index.vue_vue_type_script_setup_true_lang-Dekw0iDL.js";import"./useResetReactive-NMdkdCz2.js";const R={class:"container"},V={class:"search"},A={class:"tree-wrapper"},B={class:"tree"},L=j(e({__name:"index",emits:["node-click"],setup(e,{emit:j}){const L=j,S=a(),D=e=>{S.value&&S.value[0]===e[0]||(S.value=e,L("node-click",e))},G=a([]),I=a(!1),J=async()=>{try{I.value=!0;const{data:e}=await C();G.value=m.mapTree(e,(e=>({...e,popupVisible:!1,icon:()=>null}))),await v((()=>{var e;D([null==(e=G.value[0])?void 0:e.id])}))}finally{I.value=!1}},P=a(""),T=s((()=>{return P.value?(e=P.value.toLowerCase(),(a=>{const s=[];return a.forEach((a=>{var t,o;((null==(t=a.name)?void 0:t.toLowerCase().includes(e))||(null==(o=a.code)?void 0:o.toLowerCase().includes(e)))&&s.push({...a})})),s})(G.value)):G.value;var e})),U=a(),q=()=>{var e;null==(e=U.value)||e.onAdd()},z=(e,a)=>{var s;"update"===e?null==(s=U.value)||s.onUpdate(a.id):"delete"===e&&g.warning({title:"warning",content:`are you sure to delete [${a.name}]?`,hideCancel:!1,okButtonProps:{status:"danger"},onBeforeOk:async()=>{try{const e=await M(a.id);return e.success&&(h.success("delete successfully"),await J()),e.success}catch(e){return!1}}})};return t((()=>{J()})),(e,a)=>{const s=u("icon-search"),t=u("a-input"),m=u("icon-plus"),v=u("a-button"),g=u("a-typography-paragraph"),h=u("icon-more-vertical"),j=u("a-trigger"),C=u("a-tree"),M=w("permission");return k(),o("div",R,[l("div",V,[i(t,{modelValue:d(P),"onUpdate:modelValue":a[0]||(a[0]=e=>c(P)?P.value=e:null),placeholder:"search name/code","allow-clear":""},{prefix:n((()=>[i(s)])),_:1},8,["modelValue"]),r((k(),p(v,{type:"primary",onClick:q},{icon:n((()=>[i(m)])),_:1})),[[M,["system:dict:add"]]])]),l("div",A,[l("div",B,[i(C,{data:d(T),"field-names":{key:"id"},"block-node":"","selected-keys":d(S),onSelect:D},{title:n((e=>[i(g,{ellipsis:{rows:1,showTooltip:!0,css:!0}},{default:n((()=>[y(f(e.name)+" ("+f(e.code)+") ",1)])),_:2},1024)])),extra:n((e=>[i(j,{trigger:"click","align-point":"","animation-name":"slide-dynamic-origin","auto-fit-transform-origin":"",position:"bl","scroll-to-close":""},{content:n((()=>[i(b,{data:e,onOnMenuItemClick:z},null,8,["data"])])),default:n((()=>[d(O).hasPermOr(["system:dict:update","system:dict:delete"])?(k(),p(h,{key:0,class:"action"})):_("",!0)])),_:2},1024)])),_:1},8,["data","selected-keys"])])]),i(x,{ref_key:"DictAddModalRef",ref:U,onSaveSuccess:J},null,512)])}}}),[["__scopeId","data-v-d57dc2ba"]]);export{L as default};
