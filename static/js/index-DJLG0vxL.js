import{f as e}from"./index-FaVgdj3V.js";import{d as a,r as l,A as s,K as r,L as t,B as u,c as o,w as d,f as n,a as c,h as i,e as m,g as p,b as f,C as h,k as w,o as b,M as g,x as v}from"./index-BAyZi_co.js";import{g as y}from"./captcha-noq_IUbv.js";import{e as x}from"./encrypt-fe7GwHAY.js";import{u as _}from"./tabs-D4ctZ4n_.js";import"./index-DVDBkEOF.js";const V=["src"],j={key:0,class:"overlay"},k=v(a({__name:"index",setup(a){const v=e("login-config",{rememberMe:!0,username:"student",password:"admin123"}),k=l(!0),q=l(),M=l(),T=s({username:v.value.username,password:v.value.password,captcha:"",uuid:"",expired:!1}),U={username:[{required:!0,message:"please enter username"}],password:[{required:!0,message:"please enter password"}],captcha:[{required:k.value,message:"please enter captcha"}]};let z;r((()=>{z&&clearTimeout(z)}));const C=()=>{y().then((e=>{const{uuid:a,img:l,expireTime:s,isEnabled:r}=e.data;k.value=r,q.value=l,T.uuid=a,T.expired=!1,((e,a=Date.now())=>{z&&clearTimeout(z);const l=e-a;l<=0?T.expired=!0:z=setTimeout((()=>{T.expired=!0}),l)})(s,Number(e.timestamp))}))},L=t(),R=_(),A=w(),B=l(!1),D=async()=>{var e;try{if(await(null==(e=M.value)?void 0:e.validate()))return;B.value=!0,await L.accountLogin({username:T.username,password:x(T.password)||"",captcha:T.captcha,uuid:T.uuid}),R.reset();const{redirect:a,...l}=A.currentRoute.value.query;await A.push({path:a||"/",query:{...l}});const{rememberMe:s}=v.value;v.value.username=s?T.username:"",g.success("welcome to use")}catch(a){C(),T.captcha=""}finally{B.value=!1}};return u((()=>{C()})),(e,a)=>{const l=c("a-input"),s=c("a-form-item"),r=c("a-input-password"),t=c("a-checkbox"),u=c("a-link"),w=c("a-row"),g=c("a-button"),y=c("a-space"),x=c("a-form");return b(),o(x,{ref_key:"formRef",ref:M,model:n(T),rules:U,"label-col-style":{display:"none"},"wrapper-col-style":{flex:1},size:"large",onSubmit:D},{default:d((()=>[i(s,{field:"username","hide-label":""},{default:d((()=>[i(l,{modelValue:n(T).username,"onUpdate:modelValue":a[0]||(a[0]=e=>n(T).username=e),placeholder:"please enter username","allow-clear":""},null,8,["modelValue"])])),_:1}),i(s,{field:"password","hide-label":""},{default:d((()=>[i(r,{modelValue:n(T).password,"onUpdate:modelValue":a[1]||(a[1]=e=>n(T).password=e),placeholder:"please enter password"},null,8,["modelValue"])])),_:1}),n(k)?(b(),o(s,{key:0,field:"captcha","hide-label":""},{default:d((()=>[i(l,{modelValue:n(T).captcha,"onUpdate:modelValue":a[2]||(a[2]=e=>n(T).captcha=e),placeholder:"please enter captcha","max-length":4,"allow-clear":"",style:{flex:"1 1"}},null,8,["modelValue"]),p("div",{class:"captcha-container",onClick:C},[p("img",{src:n(q),alt:"captcha",class:"captcha"},null,8,V),n(T).expired?(b(),f("div",j,a[4]||(a[4]=[p("p",null,"expired, please refresh",-1)]))):m("",!0)])])),_:1})):m("",!0),i(s,null,{default:d((()=>[i(w,{justify:"space-between",align:"center",class:"w-full"},{default:d((()=>[i(t,{modelValue:n(v).rememberMe,"onUpdate:modelValue":a[3]||(a[3]=e=>n(v).rememberMe=e)},{default:d((()=>a[5]||(a[5]=[h("remember me")]))),_:1},8,["modelValue"]),i(u,null,{default:d((()=>a[6]||(a[6]=[h("forget password")]))),_:1})])),_:1})])),_:1}),i(s,null,{default:d((()=>[i(y,{direction:"vertical",fill:"",class:"w-full"},{default:d((()=>[i(g,{class:"btn",type:"primary",loading:n(B),"html-type":"submit",size:"large",long:""},{default:d((()=>a[7]||(a[7]=[h("login")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model"])}}}),[["__scopeId","data-v-53b27274"]]);export{k as default};
